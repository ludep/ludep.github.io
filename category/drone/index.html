
<!DOCTYPE html>
<html lang="en-US">
<!-- <!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"> -->

<!-- Mirrored from www.ludep.com/category/drone/ by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 15 Mar 2021 00:49:01 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
<head>

	<meta charset="UTF-8" />
	<title>Drone | LUDEP</title>
	<link rel="profile" href="http://gmpg.org/xfn/11" />
			

	<link rel="alternate" type="application/atom+xml" title="Atom 0.3" href="../../feed/atom/" />
	<link rel="pingback" href="../../xmlrpc.php" />

	<style type="text/css">/* no_sidebars.css */ div#wrapper { width:100%; }  body { font-size:12px; font-family:Verdana, Geneva, sans-serif; font-weight:normal; color:#505050; background-color:#ffffff; }  /* LAYOUT */ #container { margin: 0 auto; width: 990px; min-width:600px; background-color:#ffffff; } #wrapper { background-color:#ffffff; padding-top:10px; } #content { padding:0 15px 10px 15px; }  .sidebar .column { margin:19px  0 10px 0;}  .sidebar > :first-child h5 { margin-top:0; } #outer-footer { padding-top: 10px } #footer { border-bottom: 4px solid #27a5c4; border-top: 2px solid #27a5c4; background-color: #b7dee8; }  #header { color: #27a5c4; font-family:Georgia, serif; background-color:#ffffff; margin: 0; padding: 0; margin: 0; } #masthead { margin: 0px 0px 0px 10px; padding-left:0px; } #header h1, #header h3 { font-size:64px; margin:0; font-weight:normal; letter-spacing: -2px; padding:10px 0 0 0; } #header a.blankheader { display:block; height: 64px; width:300px; } #header a { text-decoration:none; color: #27a5c4; border-bottom:none; } #header .description { font-family:Georgia, serif; font-size:18px; font-weight:normal; font-style:italic; margin-top: -0.25em; padding-bottom: 5px; }  #header a.subscribe-button  {  display:block; float:right; margin-top:-20px; } #header a.subscribe-button:hover {  margin-top:-10px; } /* NAVIGATION */ /* =Menu -------------------------------------------------------------- */  #access { /*background: #000;*/ margin: 0 auto; width: 100%; display:block; float:left; /*padding: 1px 0 1px 8px;*/ border-top: 4px solid #27a5c4; border-bottom: 2px solid #27a5c4; background-color: #b7dee8; } #access .menu-header, div.menu { font-size: 13px; margin-left: 12px; } #access .menu-header ul, div.menu ul { list-style: none; margin: 0; } #access .menu-header li, div.menu li { float:left; position: relative; margin: 0; } #access a { display:block; text-decoration:none; padding:0 10px; line-height:38px; color: #707070;  font-family:Trebuchet MS, Helvetica, sans-serif; font-size:18px; font-weight:normal;   } #access ul ul { display:none; position:absolute; top:38px; left:0; float:left; z-index: 99999; border-left:  1px solid #27a5c4; border-right: 1px solid #27a5c4; border-bottom:1px solid #27a5c4; background-color: #b7dee8; } #access ul ul ul { left:100%; top:1px; border-top:1px solid #27a5c4;  } #access ul ul a { font-family:Trebuchet MS, Helvetica, sans-serif; font-size:13px; font-weight:normal; } #access ul ul a { /*background:#333;*/ height:auto; line-height:1em; padding:10px; width: 170px; } #access li:hover > a, #access ul ul :hover > a { color:#000000; /*background:#333;*/  } #access ul li:hover > ul { display:block; }  /* menu-item menu-item-type-post_type current-menu-ancestor current-menu-parent current_page_parent current_page_ancestor menu-item menu-item-type-post_type current-menu-item page_item page-item-155 current_page_item */  #access .current-menu-item, #access .current_page, #access .current_page_item, #access .current_page_item a, #access .current-menu-ancestor, #access .current_page_ancestor { color: #505050; background-color: #8bd6e0; }  div.post-list-column { float:left; width:50%; } div.post-list-column .margins { padding: 0 10px 15px 10px; } .post-list-column .storycontent, .post-list-column .content { padding:0 0 0 4px; } .post-thumbnail, .regular-post-thumbnail { border: 1px solid #eeeeee; padding:3px; }  .regular-post-thumbnail { float:left; width: 100px; margin:18px 5px 10px 10px; } .wp-post-image { max-width:100%; border: none; }  div.post-list-column .wp-post-image { display:block; }  #postpath, #postpath a { font-family:Trebuchet MS, Helvetica, sans-serif; font-size:13px; font-weight:normal; color:#707070; }  /* LINKS */  a { color:#a17244; text-decoration:underline; } .post a:visited { color: #756455; text-decoration:underline; } .post a:hover { color: #de8435; text-decoration:underline; } .post h1 a:hover,  .post h2 a:hover { border-bottom:none; text-decoration:none; }  /* HEADINGS */  h1,h2,h3, h4, h5, h6 { color: #505050; margin-top:5px; font-family:Georgia, serif; font-weight: normal; } h1, h2.h1 { font-size:36px; font-weight: normal; margin:0px 0 3px 0; padding:10px 0 0 5px; color: #505050; overflow:hidden; } .post-list-column h2 { font-size: 24px; font-weight: normal; margin:0px 0 0px 0; padding:3px 0 0px 4px; color: #505050; } h2 { /*font-size:24px;*/ margin:5px 0 2px 0; color: #505050; font-size:24px; font-weight: normal; font-family:Georgia, serif; } h3 { margin:5px 0 0px 0; font-size:18px; font-weight: normal; font-family:Georgia, serif; } .post h3 { color: #98293D; } h4 { font-size:13px; font-weight: bold; font-family:Verdana, Geneva, sans-serif; } h1 a, h2.h1 a, h1 a:visited, h2.h1 a:visited, .post h1 a, .post h2.h1 a, .post h1 a:visited, .post h2.h1 a:visited, .post-list-column h2 a, .post-list-column h2 a:visited { color: #505050; border-bottom: none; text-decoration:none; } h1 a:hover, h2.h1 a:hover, h1 a:visited:hover, h2.h1 a:visited:hover, .post h1 a:hover, .post h2.h1 a:hover, .post h1 a:visited:hover, .post h2.h1 a:visited:hover, .post-list-column h2 a:hover, .post-list-column h2 a:visited:hover { color: #000000; border-bottom: none; text-decoration:none; } h1.page-title { font-size:18px; } h1.page-title span { color: #27a5c4; } /* POST */ div.post { overflow:hidden; } table.info { padding:0; margin:0; border-collapse:collapse; } table.info td,  table.info th { padding:0; margin:0; font-weight:normal; } pre { border:1px dotted #cccccc;; margin:5px 0; padding:10px 10px 10px 20px; background-color:#fbfbfb; } blockquote{ /*background:#f2f2f2 url(img/blockquote.gif) 3px 3px no-repeat;*/ border:1px dotted #cccccc; padding:10px 10px 10px 20px; margin:5px 0 5px 20px; background-color:#fbfbfb; } code { background-color:#fbfbfb; font-family: Courier New, Courier, monospace; border:1px dotted #cccccc; } .post .storycontent, .post .content { padding:5px 10px 5px 10px; overflow:hidden; line-height: 1.5; }  .post .info { padding:3px 0px 3px 0px; margin: 2px 0 2px 0; border-top: 1px solid #eeeeee; }  .post .date { background-position:0 -48px; color: #707070; padding:0 0px; } .post .info  .postedby, .post .info  .filledunder { color: #bbb; } .post .info  .postedby  a, .post .info  .filledunder a { color: #707070; text-decoration:none; } .post .info  .postedby a:hover, .post .info  .filledunder a:hover { color: #000000; text-decoration:none; } .post .info td { border: none; padding: 0 5px; } .post table.info { width:100%; } .post .info .act { white-space: nowrap; text-align:right; } .post table.info .date { width:1%; white-space: nowrap; } .post .act span { padding-left:15px; } .post .info * { font-family: Verdana, Geneva, sans-serif; line-height:16px; font-size:10px; overflow:hidden; } hr { border: 0px none; background-color: #eeeeee; color: #eeeeee; height:2px; } fieldset{ border: 1px solid #eeeeee; padding:5px 10px 5px 10px; } legend { padding: 0px 5px 1px 5px; border: 1px solid #eeeeee; } input.text, input.textbox, input.password, input.file, textarea, input[type=text], input[type=password],input[type=file], select { border:1px solid #bbbbbb; background-color:#ffffff; padding:2px; color: #505050;  } input.text:focus, input.textbox:focus, input.password:focus, input.file:focus, textarea:focus, input[type=text]:focus, input[type=password]:focus,input[type=file]:focus, select { border:1px solid #505050; }  .post table { border-collapse:collapse; border: none; } .post  th, .post  td { border-bottom:1px solid #eeeeee; border-left:none; border-right:none; padding:2px 10px; text-align:left; vertical-align:top;  font-size: 90%;  font-weight: normal; font-family: Trebuchet MS, Helvetica, sans-serif;  } .post tr.even td { background-color: #b7dee8; } .post th  { background-color: #b7dee8; border-bottom: 1px solid #27a5c4; border-top: 2px solid #27a5c4; color: #707070; } #author-avatar { float:left; width: 100px; margin:7px 15px 7px 10px; }  /* comment START */ /* COMMENTS */ #comments > ol {list-style-type: none;line-height: 18px;margin: 0px;padding: 0px 0px 10px 10px; text-align: justify;} #comments ul li {list-style-type: none;list-style-image: none;list-style-position: outside;margin: 0 0 0 5px; padding: 5px 0 0 0;} .commentlist li {margin: 15px 0 10px;padding: 2px 2px 5px 2px;list-style: none;} .commentlist li > ul > li {background:none;list-style:none;margin:3px 0 3px 20px;padding:3px 0;} .commentlist li .avatar {border:none; margin:0;padding:1px 8px 1px 1px; width: 26px;float:left; background:none;} .commentlist .fn { font-size: 14px;  font-weight: bold; font-style: normal; padding:4px 2px 2px 2px;  font-family: Verdana, Geneva, sans-serif; } .commentlist .fn > a  { font-weight:bold; font-style: normal; text-decoration:none; } .commentlist .fn a:hover {/*text-decoration:underline;*/} .commentmetadata  { /*color:#723419;*/ font-weight: normal;  font-family: Trebuchet MS, Helvetica, sans-serif; font-size:11px;  margin:0 0 0px 20px; text-decoration: none; }  .commentmetadata a  { font-weight: normal; text-decoration: none; color: #707070; }   .vcard a.url{ color: #707070; /*#723419;*/ text-decoration: none; } .vcard a.url:hover{ color: #000000; /*#723419;*/ text-decoration: none; }  .bypostauthor >.vcard div.fn >a { color:#98293D; } .bypostauthor >.vcard div.fn >a:hover { color:#000000; } .bypostauthor>div { color:#98293D; } /*  Uncomment following text to assign specific color to admin (or to any other user) You may need to change user name here E.g.  comment-author-MyUserName instead of  comment-author-admin */ /* .comment-author-admin>*, .comment-author-admin >.vcard div.fn >a { color:#106000; }*/ .comment { color:#505050; } .commentmetadata a, .commentmetadata a:visited {color: #707070;} .commentmetadata a:hover{ color: #000000;} #comments .children { padding: 0 0 0 20px; } .thread-alt {background-color:transparent} .thread-even {background-color: transparent;} .depth-1  { border: 1px solid #27a5c4; } .depth-2, .depth-3{/*border-top: 1px solid #dac2a3;*/} .even, .alt {} .vcard { background-color:#b7dee8;} .depth-2 .vcard, .depth-3 .vcard, .depth-4 .vcard, .depth-5 .vcard, .depth-6 .vcard, .depth-7 .vcard, .depth-8 .vcard { border-top: 1px dotted #27a5c4; border-bottom: 1px dotted #27a5c4; } .reply {margin: 0px 0px 0px 10px;} .comment-reply-link { background-color:#b7dee8;color: #707070; padding: 1px 4px; font-size:12px; text-decoration: none; border: 1px dotted #27a5c4; } .comment-reply-link:hover { color: #000000; text-decoration: none; }   #comments .comment-body ul li { list-style:square; margin: 0 0 0 30px; padding:0; } #comments .comment-body ol  { margin: 0; padding: 0; } #comments .comment-body ol li { list-style-type:decimal; padding:0; margin: 0 0 0 30px; display: list-item; } .comment-body { padding:2px 2px 2px 10px; }  /************************** IMAGES *************************************/  .post img.wp-caption, .wp-caption, .gallery-caption { -moz-border-radius: 3px; /* Firefox */ -webkit-border-radius: 3px; /* Safari, Chrome */ -khtml-border-radius: 3px; /* KHTML */ border-radius: 3px; /* CSS3 */    border:1px solid #eeeeee; display:block; height:auto; margin-bottom:10px; padding-top:4px; text-align:center; max-width:100%; } .regular-post-thumbnail img.attachment-post-thumbnail { display:block; margin: auto; } .post img.wp-caption{ padding:4px; } .post .wp-caption img, .wp-caption img { border:0 none !important; margin:0 !important; padding:0 !important; max-width:99.5%; } .post img { border:none; padding:0px; vertical-align:bottom; height:auto; max-width:100%; } a.wp-caption { color: #505050; text-decoration:none; } a.wp-caption p,a.wp-caption:hover p, .wp-caption p.wp-caption-text, .full-image-caption { color:#505050; font-size:11px; font-family:Verdana, Geneva, sans-serif; line-height:12px; margin:0; padding:2px 4px 4px; } a.wp-caption:hover { border:1px solid /*#dac2a3;*/#777777; background-color:#f2f2f2; }   /****************************************************************************************** SIDEBAR *******************************************************************************************/ #sidebar .subscribe-rss { padding:10px 0 0px 42px; height:30px; display:block; font-size:20px; font-family:Verdana,Geneva,sans-serif; margin:0 0 10px 0; }  #sidebar a.subscribe-rss:hover { color:#000000; text-decoration:none; } .sidebar { font-family:Georgia, serif; font-size:13px; }  .widget { margin-bottom:10px; line-height:1.5; overflow:hidden; } .textwidget { padding:10px 5px 10px 5px; border-bottom: 1px dotted #eeeeee; line-height:1.5; } .sidebar h5 { font-size:22px; font-family: Georgia, serif; font-weight:normal; border-bottom: 2px solid #eeeeee; padding: 5px 5px 10px 10px; } .sidebar a { color: #73b655;/*#64ae42;*/ font-size:13px; text-decoration:none; } .sidebar .widget_text a, .sidebar .widget_text a:hover { text-decoration:underline; } .sidebar a:hover { color: #000000; text-decoration:none; } .sidebar li { list-style:none; margin:0; padding: 7px 5px; } .sidebar .widget>ul>li, .sidebar ul.menu>li { border-bottom: 1px dotted #eeeeee; } .sidebar .widget>ul>li>.children, .sidebar .widget .sub-menu { padding-top:7px; } .sidebar li>ul li { padding: 7px 5px 7px 10px; } .sidebar li a { /*display: block;*/ } .sidebar .blogroll li { color:  #a0a0a0; font-size: 11px; } #wp-calendar table { border-collapse:collapse; border:0px solid #eeeeee; } #wp-calendar th,  #wp-calendar  td  { border:none; padding:0px 4px; vertical-align:top; font-family: Georgia, serif; font-size:90%; } #wp-calendar td { text-align:right; } #wp-calendar th  { background-color: #eeeeee; color:#ffffff; text-align:center; padding: 1px 4px 1px 4px; } #wp-calendar caption { font-family: Georgia, serif; font-weight:bold; /*color:#777777;*/ padding:10px 0 2px 0; }  #wp-calendar td#prev { text-align:left; } #wp-calendar td#next { text-align:right; } #wp-calendar #today  /*TODO!*/ { border: 1px dotted #dddddd; background-color: #b7dee8; }  /*Search widget*/  #searchform label  { display:block; } #s { width:110px; } #searchsubmit, .button, input#submit { border:1px solid #505050; color:#ffffff; font-weight:bold; font-family:Trebucht MS, Arial; text-shadow:0 -1px 0 rgba(0, 0, 0, 0.3); cursor: pointer; padding:1px 5px 1px 5px; background: #555555;  /* for non-css3 browsers */ filter: progid:DXImageTransform.Microsoft.gradient(startColorstr='#bbbbbb', endColorstr='#000000'); /* for IE */ background: -webkit-gradient(linear, left top, left bottom, from(#bbbbbb), to(#000000)); /* for webkit browsers */ background: -moz-linear-gradient(top,  #bbbbbb,  #000000); /* for firefox 3.6+ */ } #searchsubmit:hover, .button:hover { border:1px solid #000000; }  #searchsubmit:active, .button:active { cursor: pointer; filter: progid:DXImageTransform.Microsoft.gradient(startColorstr='#505050', endColorstr='#777777'); /* for IE */ background: -webkit-gradient(linear, left top, left bottom, from(#505050), to(#777777)); /* for webkit browsers */ background: -moz-linear-gradient(top,  #505050,  #777777); /* for firefox 3.6+ */ } /* PAGINATION */  #comments a.page-numbers, #comments span.page-numbers { text-decoration: none; border: 1px solid #eeeeee; padding: 2px 5px; margin: 2px; color: #505050; }  #comments .navigation { margin: 10px 0; }  #comments .navigation a:hover { border: 1px solid #505050; background-color: #f7f7f7; color: #505050; text-decoration:none; } #comments span.page-numbers { font-weight: bold; color: #ffffff; background-color: #505050; border: 1px solid #505050; }  /* WP-PageNavi http://wordpress.org/extend/plugins/wp-pagenavi/ */  .wp-pagenavi { clear: both; }  .wp-pagenavi a, .wp-pagenavi span  { text-decoration: none; border: 1px solid #eeeeee; padding: 2px 5px; margin: 2px; color: #505050; }  .wp-pagenavi a:hover { border: 1px solid #505050; background-color: #f7f7f7; color: #505050; text-decoration:none; }  .wp-pagenavi span.current { font-weight: bold; color: #ffffff; background-color: #505050; border: 1px solid #505050; } .wp-pagenavi .extend { background:transparent;  border:0px none transparent;  color: #505050; margin-right:6px;  padding:0;  text-align:center;  text-decoration:none; }  /* used by PAGBEAR plugin for multipaged posts. http://wordpress.org/extend/plugins/pagebar/ */ .pagebar { padding:0; margin:4px 0; }  .pagebar a { background:transparent;  border: 1px solid #eeeeee; color: #505050; margin: 2px; padding:2px 5px; text-align:center; text-decoration:none; } .pageList .this-page  { font-weight: bold; color: #ffffff; background-color: #505050; border: 1px solid #505050; margin: 2px; padding:2px 5px; text-align:center; text-decoration:none; } .pagebar a:visited { color: #505050; text-decoration:none; }  .pagebar .break { background:transparent;  border:0px none transparent;  color: #505050; margin-right:6px;  padding:0;  text-align:center;  text-decoration:none; }  .pagebar .this-page { font-weight: bold; color: #ffffff; background-color: #505050; border: 1px solid #505050; margin: 2px; padding:2px 5px; text-align:center; text-decoration:none; }  .pagebar a:hover { border: 1px solid #505050; background-color: #f7f7f7; color: #505050; text-decoration:none; }  .pagebar .inactive { border: 1px solid #eeeeee; background-color: #ffffff; color: #cccccc; text-decoration: none; padding:2px 4px; }  #postnavi .prev a  { float:left; } #postnavi .next a { float:right; } #postnavi  a  { background:transparent;  border: 1px solid #eeeeee; color: #505050; margin: 2px; padding:2px 5px; text-align:center; text-decoration:none; } #postnavi a:hover { border: 1px solid #505050; background-color: #f7f7f7; color: #505050; text-decoration:none; } /* FOOTER */   .footer-column  { margin:0; padding:10px; line-height:1.5; }  #blue-footer { float:left; width: 100%; } #green-footer { float:left; width: 100%; } #orange-footer { float:left; width: 100%; } #red-footer { float:left; width: 100%; } #footer h5 { font-size:22px; font-family: Georgia, serif; font-weight:normal; border-bottom: 2px solid #eeeeee; padding: 5px 5px 10px 10px; } #footer  a { color: #73b655;/*#64ae42;*/ font-size:13px; text-decoration:none; } #footer  .widget_text a, #footer .widget_text a:hover { text-decoration:underline; } #footer  a:hover { color: #000000; text-decoration:none; } #footer  li { list-style:none; margin:0; padding: 7px 5px; } #footer .widget>ul>li, #footer  ul.menu>li { border-bottom: 1px dotted #eeeeee; } #footer  .widget>ul>li>.children, #footer  .widget .sub-menu { padding-top:7px; } #footer  li>ul li { padding: 7px 5px 7px 10px; } /*#footer li a { display: block; }*/   </style>	<link rel="stylesheet" href="../wp-content/themes/clear-line/style.css" type="text/css" media="screen" />
	
		<link rel='archives' title='August 2011' href='../../2011/08/' />
	<link rel='archives' title='July 2011' href='../../2011/07/' />
	<link rel='archives' title='June 2011' href='../../2011/06/' />
	<link rel='archives' title='May 2011' href='../../2011/05/' />
	<link rel='archives' title='April 2011' href='../../2011/04/' />
	<link rel='archives' title='March 2011' href='../../2011/03/' />
		                        <style type="text/css" media="screen" >
                                .socialwrap li.icon_text a img, .socialwrap li.iconOnly a img, .followwrap li.icon_text a img, .followwrap li.iconOnly a img{border-width:0 !important;background-color:none;}#follow.top {width:100%; position:fixed; left:0px; top:0px;}#follow.top ul {padding-left:20px;list-style-type:none;}#follow.top ul li {float:left;padding-top:4px;margin-right:10px;list-style-type:none;}#follow.top ul li.follow {color:#000;line-height:24px;}body {padding-top:32px}#follow a {text-decoration:none}
li.icon_text a span.head{}
li.icon_text a:hover span {border-bottom:solid 1px blue;}.share {margin:0 3px 3px 0;}
.phat span {display:inline;}
ul.row li {float:left;list-style-type:none;}
li.iconOnly a span.head {display:none}
#follow.left ul.size16 li.follow{margin:0px auto !important}
li.icon_text a {padding-left:0;margin-right:3px}
li.text_only a {background-image:none !important;padding-left:0;}
li.text_only a img {display:none;}
li.icon_text a span{background-image:none !important;padding-left:0 !important; }
li.iconOnly a span.head {display:none}
ul.socialwrap li {margin:0 3px 3px 0 !important;}
ul.socialwrap li a {text-decoration:none;}ul.row li {float:left;line-height:auto !important;}
ul.row li a img {padding:0}.size16 li a,.size24 li a,.size32 li a, .size48 li a, .size60 li a {display:block}ul.socialwrap {list-style-type:none !important;margin:0; padding:0;text-indent:0 !important;}
ul.socialwrap li {list-style-type:none !important;background-image:none;padding:0;list-style-image:none !important;}
ul.followwrap {list-style-type:none !important;margin:0; padding:0}
ul.followwrap li {margin-right:3px;margin-bottom:3px;list-style-type:none !important;}
#follow.right ul.followwrap li, #follow.left ul.followwrap li {margin-right:0px;margin-bottom:0px;}
.shareinpost {clear:both;padding-top:0px}.shareinpost ul.socialwrap {list-style-type:none !important;margin:0 !important; padding:0 !important}
.shareinpost ul.socialwrap li {padding-left:0 !important;background-image:none !important;margin-left:0 !important;list-style-type:none !important;text-indent:0 !important}
.socialwrap li.icon_text a img, .socialwrap li.iconOnly a img{border-width:0}ul.followrap li {list-style-type:none;list-style-image:none !important;}
div.clean {clear:left;}
div.display_none {display:none;}
                        </style>
                                                <style type="text/css" media="print" >
                                body {background: white;font-size: 12pt;color:black;}
 * {background-image:none;}
 #wrapper, #content {width: auto;margin: 0 5%;padding: 0;border: 0;float: none !important;color: black;background: transparent none;}
 a { text-decoration : underline; color : #0000ff; }
#menu, #navigation, #navi, .menu {display:none}
                        </style>
                        <link rel="image_src" href="#" /> 
<link rel='dns-prefetch' href='http://s.w.org/' />
<link rel="alternate" type="application/rss+xml" title="LUDEP &raquo; Feed" href="../../feed/" />
<link rel="alternate" type="application/rss+xml" title="LUDEP &raquo; Comments Feed" href="../../comments/feed/" />
<link rel="alternate" type="application/rss+xml" title="LUDEP &raquo; Drone Category Feed" href="feed/" />
<!-- This site is powered by Shareaholic - https://shareaholic.com -->
<script type='text/javascript' data-cfasync='false'>
  //<![CDATA[
    _SHR_SETTINGS = {"endpoints":{"local_recs_url":"https:\/\/www.ludep.com\/wp-admin\/admin-ajax.php?action=shareaholic_permalink_related"}};
  //]]>
</script>
<script type='text/javascript' data-cfasync='false'
        src='../../../dsms0mj1bbhn4.cloudfront.net/assets/pub/shareaholic.js'
        data-shr-siteid='dfcda9e11023ab5708e53ad765e54924' async='async' >
</script>

<!-- Shareaholic Content Tags -->
<meta name='shareaholic:site_name' content='LUDEP' />
<meta name='shareaholic:language' content='en-US' />
<meta name='shareaholic:site_id' content='dfcda9e11023ab5708e53ad765e54924' />
<meta name='shareaholic:wp_version' content='7.6.1.2' />

<!-- Shareaholic Content Tags End -->
		<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/11.2.0\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/11.2.0\/svg\/","svgExt":".svg","source":{"concatemoji":"https:\/\/www.ludep.com\/wp-includes\/js\/wp-emoji-release.min.js?ver=5.1.8"}};
			!function(a,b,c){function d(a,b){var c=String.fromCharCode;l.clearRect(0,0,k.width,k.height),l.fillText(c.apply(this,a),0,0);var d=k.toDataURL();l.clearRect(0,0,k.width,k.height),l.fillText(c.apply(this,b),0,0);var e=k.toDataURL();return d===e}function e(a){var b;if(!l||!l.fillText)return!1;switch(l.textBaseline="top",l.font="600 32px Arial",a){case"flag":return!(b=d([55356,56826,55356,56819],[55356,56826,8203,55356,56819]))&&(b=d([55356,57332,56128,56423,56128,56418,56128,56421,56128,56430,56128,56423,56128,56447],[55356,57332,8203,56128,56423,8203,56128,56418,8203,56128,56421,8203,56128,56430,8203,56128,56423,8203,56128,56447]),!b);case"emoji":return b=d([55358,56760,9792,65039],[55358,56760,8203,9792,65039]),!b}return!1}function f(a){var c=b.createElement("script");c.src=a,c.defer=c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var g,h,i,j,k=b.createElement("canvas"),l=k.getContext&&k.getContext("2d");for(j=Array("flag","emoji"),c.supports={everything:!0,everythingExceptFlag:!0},i=0;i<j.length;i++)c.supports[j[i]]=e(j[i]),c.supports.everything=c.supports.everything&&c.supports[j[i]],"flag"!==j[i]&&(c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&c.supports[j[i]]);c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&!c.supports.flag,c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.everything||(h=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",h,!1),a.addEventListener("load",h,!1)):(a.attachEvent("onload",h),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),g=c.source||{},g.concatemoji?f(g.concatemoji):g.wpemoji&&g.twemoji&&(f(g.twemoji),f(g.wpemoji)))}(window,document,window._wpemojiSettings);
		</script>
		<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
	<link rel='stylesheet' id='wp-block-library-css'  href='../../wp-includes/css/dist/block-library/style.min9738.css?ver=5.1.8' type='text/css' media='all' />
<link rel='stylesheet' id='wpt-twitter-feed-css'  href='../wp-content/plugins/wp-to-twitter/css/twitter-feed9738.css?ver=5.1.8' type='text/css' media='all' />
<!-- This site uses the Google Analytics by MonsterInsights plugin v5.5.4 - Universal enabled - https://www.monsterinsights.com/ -->
<script type="text/javascript">
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
		(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
		m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','../../../www.google-analytics.com/analytics.js','__gaTracker');

	__gaTracker('create', 'UA-22499108-1', 'auto');
	__gaTracker('set', 'forceSSL', true);
	__gaTracker('send','pageview');

</script>
<!-- / Google Analytics by MonsterInsights -->
<script type='text/javascript' src='../../wp-includes/js/jquery/jqueryb8ff.js?ver=1.12.4'></script>
<script type='text/javascript' src='../../wp-includes/js/jquery/jquery-migrate.min330a.js?ver=1.4.1'></script>
<script type='text/javascript' src='../../wp-includes/js/jquery/ui/core.mine899.js?ver=1.11.4'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var social_connect_data = {"wordpress_enabled":""};
/* ]]> */
</script>
<script type='text/javascript' src='../wp-content/plugins/social-connect/media/js/connect9738.js?ver=5.1.8'></script>
<link rel='https://api.w.org/' href='../../wp-json/' />
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="../../xmlrpc0db0.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="../../wp-includes/wlwmanifest.xml" /> 

<link rel="shortcut icon" href="../wp-content/plugins/multicons/images/favicon.ico" />



<link rel='stylesheet' id='social_connect-css'  href='../wp-content/plugins/social-connect/media/css/style9738.css?ver=5.1.8' type='text/css' media='all' />
<link rel='stylesheet' id='dashicons-css'  href='../../wp-includes/css/dashicons.min9738.css?ver=5.1.8' type='text/css' media='all' />
<link rel='stylesheet' id='wp-jquery-ui-dialog-css'  href='../../wp-includes/css/jquery-ui-dialog.min9738.css?ver=5.1.8' type='text/css' media='all' />
		<style type="text/css">
						ol.footnotes li {list-style-type:decimal;}
						ol.footnotes{font-size:0.8em; color:#666666;}		</style>
		<link rel="Shortcut Icon" type="image/x-icon" href="../../favicon.ico" />
</head>
<body class="archive category category-drone category-8">
	<div id="container" class="hfeed">
	<div id="header">
		<div id="masthead">
						<div style="float:left;">
																						<h3><a href="../../">LUDEP</a></h3>
													<div class="description">Leading Units &amp; Drone Enabled Probing</div>
												</div>
			<div class="clear"></div>
		</div>
					<div id="access">
				<div class="menu"><ul>
<li class="page_item page-item-6"><a href="../../">Home</a></li>
<li class="page_item page-item-9 current_page_parent"><a href="../../blog/">Blog</a></li>
<li class="page_item page-item-47"><a href="../../project/">The project</a></li>
<li class="page_item page-item-50"><a href="../../links-downloads/">Links &#038; Downloads</a></li>
<li class="page_item page-item-30"><a href="../../about/">About</a></li>
</ul></div>
				<div class="clear"></div>
			</div>
				<div class="clear"></div>
	</div>
		<div class="sidebar">
					</div>


<!-- end header --><div id="wrapper">
	<div id="content-wrapper">
		<div id="content" role="main">
			
	<h1 class="page-title">
						Category: <span>Drone</span>			</h1>
  
  
				<div id="post-1033" class="post post-1033 type-post status-publish format-standard has-post-thumbnail hentry category-drone category-ground-robots category-ideas category-programming category-testing">
		<h2 class="h1"><a href="../../final-words-on-the-drone-merging-previous-work-with-new-tasks/" rel="bookmark">Final words on the drone: merging previous work with new tasks</a></h2>

					<table class="info entry-meta">
				<tr>
					<td class="date">August 23, 2011</td>
					<td>
													<span class="postedby">
								Posted by <a href="http://michael/" title="Visit Michael&#8217;s website" rel="author external">Michael</a> 
							</span>
								<span class="filledunder">under</span>
												<span class="filledunder">
							<a href="" rel="category tag">Drone</a>, <a href="../ground-robots/" rel="category tag">Ground robots</a>, <a href="../ideas/" rel="category tag">Ideas</a>, <a href="../programming/" rel="category tag">Programming</a>, <a href="../testing/" rel="category tag">Testing</a>						</span>
					</td>
											<td>
						
				
							<div class="act">
																	<span class="comments">Comments off</span>
																							</div>
						</td>
					
				</tr>
			</table>
				
									
		
		
		<div class="content">
			
			<div style="float:right;padding: 0 0 10px 10px" class="interactive_right"><iframe allowtransparency="true" frameborder="0" scrolling="no" src="http://platform.twitter.com/widgets/tweet_button.html?url=https%3A%2F%2Fwww.ludep.com%2Ffinal-words-on-the-drone-merging-previous-work-with-new-tasks%2F&amp;text=Final%20words%20on%20the%20drone:%20merging%20previous%20work%20with%20new%20tasks&amp;count=vertical&amp;lang=" style="width:65px; height:65px;"></iframe><iframe src="http://www.facebook.com/plugins/like.php?href=https%3A%2F%2Fwww.ludep.com%2Ffinal-words-on-the-drone-merging-previous-work-with-new-tasks%2F&amp;layout=box_count&amp;show_faces=false&amp;width=65&amp;action=like&amp;font=arial&amp;colorscheme=light&amp;height=65" scrolling="no" frameborder="0" style="border:none; overflow:hidden; width:65px; height:65px;" allowTransparency="true"></iframe></div><h2>Last automatic control improvements</h2>
<h3>What is wrong with our Proportional Integrative Derivative (PID) controller&#8230;</h3>
<p style="text-align: justify;">We have spent quite a good amount of time implementing, testing, tuning parameters and tweaking our PID controller over the last months. Our understanding of all its underlying theoretical aspects -mathematical, physical and computational- improved as much, and our results got generally better with time. Overall, we managed to get our drone to stay on top of a defined target, at a given altitude, without drifting much. However, our main concern was that, at some point, after a few minutes of running time, it would start describing circles around the target that would get bigger and bigger, or simply drift away. It was made clear that it was nothing due to our detection algorithm, but rather had to do with our PID.</p>
<p style="text-align: justify;">And indeed, when we started to take again some hindsight and got back on all our results and data, we confirmed our very first doubts. PID controllers are great when you have to stabilize a system with one degree of freedom; more precisely, they are efficient when you need to work with one error parameter, which can be corrected by a set of actuators that do not have influence of any sort on other error parameters which also have to be regulated. Here, with our drone, we face a situation with three degrees of freedom (i.e. pitch, roll, yaw) that we try to stabilize toward our goal, and thanks to the very same actuators (i.e. our four rotors). Well, so far, we have not even tried to mess with yawing, since it was not absolutely required to achieve our project. Therefore, every time our algorithm needs to correct one degree of freedom, it is influencing the correction of the other, which needs then a better correction, and it goes on toward more and more instability, making it an explosive system.</p>
<p style="text-align: justify;">This is the conclusion we eventually came to, and that is commonly admitted by other people working on this kind of system<sup><a href="#footnote_0_1033" id="identifier_0_1033" class="footnote-link footnote-identifier-link" title="Dronolab, a quadrotor project involving mechanical, electrical and software engineering students. They moved from a PID controller to a more sophisticated one. http://dronolab.etsmtl.ca/uav/">1</a></sup>. A solution has been researched to solve this difficulty, and a non-linear stabilization algorithm<sup><a href="#footnote_1_1033" id="identifier_1_1033" class="footnote-link footnote-identifier-link" title="Daniel Tabak, on a general digitally controlled system: An Algorithm for Nonlinear Process Stabilization and Control, 1970">2</a></sup>, adapted to the four rotors design, seems to be the more appropriate. Solutions have been designed, implemented and experimented successfully<sup><a href="#footnote_2_1033" id="identifier_2_1033" class="footnote-link footnote-identifier-link" title="A interesting thorough study on the design of an embedded control architecture for a four-rotors unmanned air vehicle to perform autonomous hover ﬂight:&nbsp;Escareno J., Salazar-Cruz S. and Lozano R, Embedded control of a four-rotor UAV, 2006">3</a></sup>, on similar platforms. This is a vast field of study in itself, and could still use more investigation. Unfortunately, this calls for some long dwelling on the mechanics of the quadricopter, and would require to have independent access to each of the motors (with the API, we can only control movements at a higher level, by choosing the pitch, roll and yaw), and preferably on the embedded firmware, both of which being as for now not made possible by Parrot who designed our ARDrone.</p>
<h3 style="text-align: left;">Patching our PID controller with an auto-hovering threshold</h3>
<p style="text-align: justify;">Once again, we wanted to find our way toward our project&#8217;s goal by investigating our own solutions. As we saw it during <a title="First experiment with auto-tracking" href="../../first-experiments/" target="_blank">the first experiment we performed</a> at the beginning of our project, the embedded hovering function is pretty efficient in terms of stabilizing the drone. And stabilization is a feature we lack when our PID is reaching its zero-error point, since this is when it starts to &#8220;explode&#8221; by correcting parameters it should, due to small errors right on top of the target (our PID is nevertheless best at going right to the target, by adjusting itself progressively, without much overshoot, when the drone is further from its target).</p>
<p style="text-align: justify;">However, we cannot rely on this hovering feature alone to track one robot, not to mention a whole flock of them. As a consequence, we thought about the following compromise: auto-hovering (i.e. stabilized hovering performed by an embedded algorithm we do not control) would be automatically activated when the drone finds itself in a circular area on top of our point of interest (the robot leader), whereas our PID controller would take control over the motor when outside of this restricted area (cf. <strong>Figure 1</strong>).</p>
<table class="aligncenter" width="500" align="center">
<tbody>
<tr>
<td><a href="../wp-content/uploads/2011/08/hoverArea.png"><img class="aligncenter size-medium wp-image-1049" title="hoverArea" src="../wp-content/uploads/2011/08/hoverArea.png" alt="" width="500" height="440" srcset="../wp-content/uploads/2011/08/hoverArea.png 662w, ../wp-content/uploads/2011/08/hoverArea-300x263.png 300w, ../wp-content/uploads/2011/08/hoverArea-100x87.png 100w" sizes="(max-width: 500px) 100vw, 500px" /></a></td>
</tr>
<tr>
<th><strong>Figure 1</strong>: Illustration of the behavior of the drone. The green rectangle shows the 2D field of view (FOV) as it is projected on the ground for the vertical camera. As long as the error radius (distance between target and drone) is greater than a threshold, the drone is controlled by our PID regulator. Once it reaches this threshold, PID control is stopped and the embedded hovering algorithm takes over and tries to stabilize the quadricopter.</th>
</tr>
</tbody>
</table>
<p style="text-align: justify;">By combining the best of both designs, we did achieve our best stabilization so far. Then, tracking a moving robot is also a task well-performed, which now completely fulfills the purpose of our drone, when added to the flock coordinate-reporting process. Yet we really lacked a bigger test-room setting, where our main concern was the low ceiling, preventing a long-term efficient robot-tracking, since it is really hard to keep even one robot in the camera field of view when you cannot fly comfortably higher than an average of 1,8 meters. Well, at least, that put some stimulating additional challenge into our tasks.</p>
<h2 style="text-align: justify;">Drone and ground units: how our UAV is fully controlled</h2>
<p style="text-align: justify;">We have accomplished many tasks with our ARDrone, so it might not seem quite obvious what their purpose are in the scope of our project, to the point where one could wonder how we give it commands depending on which events. This part of our article focuses on a quick recap on all the implemented methods that enable the drone to do its required actions.</p>
<h3 style="text-align: justify;">Auto landing and taking-off</h3>
<p style="text-align: justify;">Landing and taking-off are the only two stages of a whole flight over which we cannot have any control beyond sending commands to start either of those maneuvers. Once the drone acknowledges the command, the embedded software takes over the controls and operates it. Our custom algorithm never triggers these operations, which are decided by the person in charge of the drone who uses a specifically programmed controller (see part below).</p>
<p style="text-align: justify;">Besides, safe landing may happen without our own input, in case of low battery.</p>
<h3 style="text-align: justify;">Manual control</h3>
<p style="text-align: justify;">Even though most of flying time is managed by our custom algorithm which takes control over commands of the drone, we still need to be able to enter some user input at some point. The drone is first of all a rather flimsy and even sometimes dangerous flying object that could deal some minor damage to itself our its surroundings in case of bad handling: it is therefore necessary to have at least the capacity to quickly stop it completely in an emergency, or better, to switch back to a full human control in case of unwanted behavior. Moreover, since our algorithms are a lot about tuning parameters, it is advisable to enable on-the-flight parameter tweaking. The most appropriate way appeared to use a game controller that we would map to take advantage of all the sticks (great for moving the drone) and the different buttons (to give more custom orders).</p>
<p style="text-align: justify;"><strong>Figure 2</strong> shows the XBox 360 we chose and how we map its buttons to call different functions in our program. The following sums up our gamepad functionalities:</p>
<ul style="text-align: justify;">
<li><strong>Start or stop landing or taking off</strong> phase. This can be done at any time.</li>
<li><strong>Emergency stop</strong>, enabled at any time, to suddenly cut all four motors. Sometimes also required before a new take off to reset the drone&#8217;s state.</li>
<li><strong>Flat trim</strong> tells the drone that it is currently in a horizontal position: necessary for proper landing, take off and hovering &#8211; and should be done before taking off.</li>
<li><strong>Yaw, altitude, pitch and roll</strong> represent all degrees of freedom of the drone, split on two sticks. If our custom algorithm is disabled, then it is possible to control all the drone&#8217;s movements into 3D space in real-time.</li>
<li><strong>Start or stop custom algorithm</strong> enables or disables our control algorithm that will try to locate and track a leader on the ground, while reporting coordinates of all units in the flock to the leader.</li>
<li><strong>Viewpoint</strong> changes the camera viewpoint displayed on the user screen (switching between vertical, horizontal, or both cameras). While custom algorithm is enabled, you want and need to use the vertical camera.</li>
<li><strong>Stop program</strong> stops pretty much everything, except manual control.</li>
<li><strong>Start/stop hovering</strong> disables custom algorithm and manual input to activate the embedded function that stabilizes the drone. It comes of great use when you just need a stable hovering drone that does not move much.</li>
<li>At last, you can select PID parameters, one after the other, and change them.</li>
</ul>
<p>&nbsp;</p>
<table class="aligncenter" width="500" align="center">
<tbody>
<tr>
<td><a href="../wp-content/uploads/2011/08/x360_controller_drone_transparent.png"><img class="aligncenter size-medium wp-image-1050" title="x360_controller_drone_transparent" src="../wp-content/uploads/2011/08/x360_controller_drone_transparent.png" alt="" width="500" height="338" srcset="../wp-content/uploads/2011/08/x360_controller_drone_transparent.png 1047w, ../wp-content/uploads/2011/08/x360_controller_drone_transparent-300x202.png 300w, ../wp-content/uploads/2011/08/x360_controller_drone_transparent-1024x692.png 1024w, ../wp-content/uploads/2011/08/x360_controller_drone_transparent-100x67.png 100w" sizes="(max-width: 500px) 100vw, 500px" /></a></td>
</tr>
<tr>
<th><strong>Figure 2</strong>: Finally, this is how our controller is mapped. We get with it an absolute control over all the possible actions of the drone in real-time, on top of lots of ease to tune our parameters during running time. Note that this should work with any other generic controller (at least remotely compatible with Linux).</th>
</tr>
</tbody>
</table>
<p>&nbsp;</p>
<h3 style="text-align: justify;">Algorithm control</h3>
<p style="text-align: justify;">By a simple button press, one can enable our disable our custom algorithm. But what exactly does it encompass ?</p>
<h4 style="text-align: justify;">Double PID</h4>
<p style="text-align: justify;">We have a double PID controller affecting three degrees of freedom, in order to stabilize two behaviors:</p>
<ul style="text-align: justify;">
<li>a constant altitude, that we want to be set (by default) around 1,8 meters. This is done through the <code>gaz</code> command.</li>
<li>tracking the leader, and hovering on top of it by detecting its tag. This is done through the <code>pitch</code> and <code>roll</code> commands.</li>
</ul>
<p style="text-align: justify;">More details are provided in the first part of this article and in previous ones: <a title="Performing simple image analysis and full PID controller with the Drone" href="../../performing-simple-image-analysis-and-full-pid-controller-with-the-drone/" target="_blank">1</a>, <a title="Drone: new PID with polar coordinates and HowTo improve reactivity and accuracy" href="../../drone-new-pid-with-polar-coordinates-and-howto-improve-reactivity-and-accuracy/" target="_blank">2</a>.</p>
<h4 style="text-align: justify;">Tilt handling</h4>
<p style="text-align: justify;">Coordinates of the target to follow are corrected depending on the inclination and the altitude of the drone, before being fed to the PID loop. This problem and its solution are thoroughly discussed <a title="Tracking algorithm: considering the inclination of the drone" href="../../tracking-algorithm-considering-the-inclination-of-the-drone/" target="_blank">in a former article</a>.</p>
<h4 style="text-align: justify;">Detecting ground units and reporting their coordinates</h4>
<p style="text-align: justify;">Not only do we detect the tag that the drone has to track, but we also use <a title="Image analysis: color detection for multiple robots" href="../../image-analysis-color-detection-for-multiple-robots/" target="_blank">our color object detection algorithm</a> to report all coordinates of the whole set of robots to the leader of the flock.</p>
<p style="text-align: justify;">This implies that it also handles a part of a network layer, while the program starts a thread that acts as a client connecting to the leader.</p>
<h4 style="text-align: justify;">Change of tracked leader</h4>
<p style="text-align: justify;">The very last feature we needed to carry out in order to fulfill our main goals was to make sure we are tracking the right robot. Since all the robots are supposed to follow the leader, and the leader being controlled by a human user, it seems appropriate to track the unit targeted by the other units.  This way, we make sure that the leader in always in sight, which enables establishing the rest of the formation accordingly. Furthermore, if a random unit were to get lost (out of the camera&#8217;s FOV), the leader, assisted by a human, could go looking for it; once it gets close to the lost unit, the latter becomes part of the formation again, since it is finally in the camera&#8217;s FOV.</p>
<p style="text-align: justify;">We then had to establish a protocol to decide who is going to be the leader, how the drone gets this information and how it should respond to it:</p>
<ol>
<li style="text-align: justify;">Leader number (<code>LeaderNumber</code>, i.e. the id of the robot chosen as a leader) is decided on the flock side, usually by the human who controls the leader itself.</li>
<li style="text-align: justify;"><code>LeaderNumber</code> is passed to the drone&#8217;s program through the same client/server socket connection that is used for sending the flock coordinates. The drone has a thread continuously listening for new events on this socket, and registers the current <code>LeaderNumber</code>.</li>
<li style="text-align: justify;">Once we get this <code>LeaderNumber</code>, the drone has to try to follow the corresponding unit on the ground. However, in some cases, the unit may not be in sight, or the <code>LeaderNumber</code> may not even be decided yet. The logical steps that help the drone take the right course of action is detailed in the decision tree in <strong>Figure 3</strong>.</li>
</ol>
<p>&nbsp;</p>
<table class="aligncenter" width="573" align="center">
<tbody>
<tr>
<td><a href="../wp-content/uploads/2011/08/LeaderNumber_DecisionTree_transparent.png"><img class="aligncenter size-full wp-image-1051" title="LeaderNumber_DecisionTree_transparent" src="../wp-content/uploads/2011/08/LeaderNumber_DecisionTree_transparent.png" alt="" width="573" height="477" srcset="../wp-content/uploads/2011/08/LeaderNumber_DecisionTree_transparent.png 819w, ../wp-content/uploads/2011/08/LeaderNumber_DecisionTree_transparent-300x249.png 300w, ../wp-content/uploads/2011/08/LeaderNumber_DecisionTree_transparent-100x83.png 100w" sizes="(max-width: 573px) 100vw, 573px" /></a></td>
</tr>
<tr>
<th><strong>Figure 3</strong>: Decision tree to find the number (id) of the robot leader and the drone&#8217;s action that should ensue. <em>Hover</em> means here simply hovering on the current spot, with the embedded stabilization algorithm.</th>
</tr>
</tbody>
</table>
<p style="text-align: justify;">
Basically, this means that we have added a new way to directly influence the behavior of the drone, by adding a input for the robot leader, on top of the human direct input with the gamepad and the algorithmic PID control.</p>
<h4>Testing everything together</h4>
<p style="text-align: justify;">Our very last tests include all the above-mentioned features, that appear to work quite smoothly simultaneously, even when working with our flock of four robots. No unexpected behaviors were observed during our final experiments, so everything was pretty much already discussed in previous articles. The last part that was asking for testing consists in the leader switching task. Since our robot detection, our communication protocol and our drone hovering were already performing good separately, we did not have much tuning to do. Video 1 below is here to illustrate this performance.</p>
<p>&nbsp;</p>
<table class="aligncenter" width="420" align="center">
<tbody>
<tr>
<td><object width="420" height="345" classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" codebase="http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=6,0,40,0"><param name="allowFullScreen" value="true" /><param name="allowscriptaccess" value="always" /><param name="src" value="http://www.youtube.com/v/_EKoG7ML7VU?version=3&amp;hl=en_US" /><param name="allowfullscreen" value="true" /><embed width="420" height="345" type="application/x-shockwave-flash" src="http://www.youtube.com/v/_EKoG7ML7VU?version=3&amp;hl=en_US" allowFullScreen="true" allowscriptaccess="always" allowfullscreen="true" /></object></td>
</tr>
<tr>
<th><strong>Video 1</strong>: The ARDrone is tracking two robots from our flock. Our flock-control program switches the &#8220;leader&#8221; (done manually here, for illustration purpose), i.e. the robot that leads the flock and that the drone is supposed to follow.So here, the leader switches back and forth between red and blue, and the drone moves accordingly and tries to hover on top of it.Hovering is not 100% steady. This is greatly due to a lack of altitude from the drone; our ceiling is too low to get a field of view good enough!For filming and testing purpose, it was necessary to focus on no more than two still units. Note that it however work as good as with more, moving robots.</th>
</tr>
</tbody>
</table>
<p>Videos and other more complete experiments will be to watch in our next article, where we deal with the whole flock and the drone.&nbsp;<br />
<b>References</b></p>
<ol class="footnotes">
<li id="footnote_0_1033" class="footnote"><em>Dronolab, a quadrotor project involving mechanical, electrical and software engineering students.</em> They moved from a PID controller to a more sophisticated one. <a href="http://dronolab.etsmtl.ca/uav/" onclick="__gaTracker('send', 'event', 'outbound-article', 'http://dronolab.etsmtl.ca/uav/', 'http://dronolab.etsmtl.ca/uav/');" target="_blank">http://dronolab.etsmtl.ca/uav/</a> [<a href="#identifier_0_1033" class="footnote-link footnote-back-link">&#8617;</a>]</li>
<li id="footnote_1_1033" class="footnote">Daniel Tabak, on a general digitally controlled system: <em>An Algorithm for Nonlinear Process Stabilization and Control, 1970</em> [<a href="#identifier_1_1033" class="footnote-link footnote-back-link">&#8617;</a>]</li>
<li id="footnote_2_1033" class="footnote">A interesting thorough study on the design of an embedded control architecture for a four-rotors unmanned air vehicle to perform autonomous hover ﬂight: <em>Escareno J., Salazar-Cruz S. and Lozano R, Embedded control of a four-rotor UAV, 2006</em> [<a href="#identifier_2_1033" class="footnote-link footnote-back-link">&#8617;</a>]</li>
</ol>
<div class='shareaholic-canvas' data-app-id='17416102' data-app='recommendations' data-title='Final words on the drone: merging previous work with new tasks' data-link='https://www.ludep.com/final-words-on-the-drone-merging-previous-work-with-new-tasks/' data-summary=''></div>		</div>
		<div class="clear"></div>
		
	</div>
		<div id="post-907" class="post post-907 type-post status-publish format-standard has-post-thumbnail hentry category-drone category-programming category-testing">
		<h2 class="h1"><a href="../../image-analysis-color-detection-for-multiple-robots/" rel="bookmark">Image analysis: color detection for multiple robots</a></h2>

					<table class="info entry-meta">
				<tr>
					<td class="date">August 17, 2011</td>
					<td>
													<span class="postedby">
								Posted by <a href="http://michael/" title="Visit Michael&#8217;s website" rel="author external">Michael</a> 
							</span>
								<span class="filledunder">under</span>
												<span class="filledunder">
							<a href="" rel="category tag">Drone</a>, <a href="../programming/" rel="category tag">Programming</a>, <a href="../testing/" rel="category tag">Testing</a>						</span>
					</td>
											<td>
						
				
							<div class="act">
																	<span class="comments">Comments off</span>
																							</div>
						</td>
					
				</tr>
			</table>
				
									
		
		
		<div class="content">
			
			<div style="float:right;padding: 0 0 10px 10px" class="interactive_right"><iframe allowtransparency="true" frameborder="0" scrolling="no" src="http://platform.twitter.com/widgets/tweet_button.html?url=https%3A%2F%2Fwww.ludep.com%2Fimage-analysis-color-detection-for-multiple-robots%2F&amp;text=Image%20analysis:%20color%20detection%20for%20multiple%20robots&amp;count=vertical&amp;lang=" style="width:65px; height:65px;"></iframe><iframe src="http://www.facebook.com/plugins/like.php?href=https%3A%2F%2Fwww.ludep.com%2Fimage-analysis-color-detection-for-multiple-robots%2F&amp;layout=box_count&amp;show_faces=false&amp;width=65&amp;action=like&amp;font=arial&amp;colorscheme=light&amp;height=65" scrolling="no" frameborder="0" style="border:none; overflow:hidden; width:65px; height:65px;" allowTransparency="true"></iframe></div><h2 style="text-align: justify;">Introduction to our problem</h2>
<p style="text-align: justify;">Image analysis is nothing new in our project. We have already performed some by ourselves, using the vertical camera of the drone to track roundels on the ground. While this was a good solution, quite fast to implement and that did not required lots of tuning, it is no longer valid anymore when it comes to detecting more that one robot and differentiating all the units, since we were only considering a circular shape.</p>
<p style="text-align: justify;">We might have tried to identify the robots by the size of their circle marker that could be different according to the id of the robot. It works in a very well-defined environment (steady camera, not too many, too small nor too close roundels); yet the camera is moving, even vertically, so the size of one roundel is never constant (thus making an absolute size detection impossible &#8211; i.e. attributing one specific roundel size to a robot&#8217;s id) and the resolution of the camera not good enough for that purpose, compared to the precision of the altitude sensor that could have help correct the size estimation depending on the altitude. Finally, some robots may not be in the camera&#8217;s field of view from time to time (thus making a relative detection impossible &#8211; i.e. guessing a robot&#8217;s id by observing that its circle is bigger or smaller than the one of its neighbor). The low resolution of the camera plays an important part in what we can or cannot do: while it is good enough for localization purpose of one point, it is not sufficient enough to tell the difference between different small variations of size for multiple objects that are around 20 centimeters big &#8211; besides, the more the robots are on the field, the higher the drone needs to be in the sky, and the harder it gets to achieve such an analysis.</p>
<table class="aligncenter" width="420" align="center">
<tbody>
<tr>
<td><a href="../wp-content/uploads/2011/08/markers_closeup_edit.png"><img class="aligncenter size-medium wp-image-945" title="markers_closeup" src="../wp-content/uploads/2011/08/markers_closeup_edit-300x146.png" alt="" width="300" height="146" srcset="../wp-content/uploads/2011/08/markers_closeup_edit-300x146.png 300w, ../wp-content/uploads/2011/08/markers_closeup_edit-1024x498.png 1024w, ../wp-content/uploads/2011/08/markers_closeup_edit-100x48.png 100w" sizes="(max-width: 300px) 100vw, 300px" /></a></td>
</tr>
<tr>
<th style="text-align: justify;"><strong>Figure 1</strong>: Two of the markers installed on top of the omnidirectional robots. They are made of a brightly colored paper sheet folded into a polygon shape, with one angle providing a direction. Each shape is mounted on a LEGO support, of which one can notice the small &#8220;arms&#8221; going out of the polygons.</th>
</tr>
</tbody>
</table>
<p style="text-align: justify;">So the solution has to be different in terms of the type of object we want to detect. Furthermore this type of object also has to enable a differentiation between many robots (up to ten if we want to be realistic given the system we have). Using the robot itself as an object to be detected is not doable, since all of them have the same shape, and the differences that we could physically build on them would be too minor to be noticed from the sky with our low-resolution camera. Moreover, a robot is a complex object from a camera point of view, and it is harder to detect a complex object with irregularities, holes, reliefs that spawn shadows, etc. than a simpler, flat one. Like we previously did with the roundel, we need a marker for each robot. Figure 1 shows the kind of marker we put on our robots.</p>
<p style="text-align: justify;">We keep using the open source computer vision framework OpenCV to take advantage of its large number of already implemented algorithms and its C++ compatibility.</p>
<h3 style="text-align: justify;">Solutions for detecting a marker</h3>
<p style="text-align: justify;">OpenCV provides developers with hundreds of algorithms that are designed to solve many problems, and often a dozen of implemented techniques might be applied to approach the same problem in different ways. Computer vision being only a fraction of what we learned and used as computer science students and interns, we cannot pretend to have an extensive knowledge of most of the possible solutions to our situation, hence our perhaps limited below suggestions that had to fit within the scope of our project. Our goal is to get a workable result that proves a concept &#8211; once this is done, if it only works with a defined set of robots and markers because of our lack of practice with image analysis and OpenCV, then we know that it could be improved to be fully made all-purpose with more time spent on the mathematical side of the algorithms and their implementation.</p>
<ul>
<li style="text-align: justify;"><strong>Lukas-Kanade feature tracking algorithm</strong><sup><a href="#footnote_0_907" id="identifier_0_907" class="footnote-link footnote-identifier-link" title="Article by B. Lucas and T. Kanade, an iterative image registration technique with an application to stereo vision in Int. Joint Conference in Artificial Intelligence, pp. 674-680, 1981, describing the original feature point tracking algorithm.">1</a></sup> that exploits the fundamental optical flow constraint equation. This methods tracks features points as they move from frame to frame. It starts detecting a group of features points in an initial frame and then tries to find them in the next frame, and keep doing so while updating from time to time the feature points. While this may be a valid solution with a static camera where only the robots are moving, it will surely be harder if not impracticable with a moving camera and moving robots.</li>
</ul>
<ul>
<li style="text-align: justify;"><strong>Mixture of Gaussian method</strong><sup><a href="#footnote_1_907" id="identifier_1_907" class="footnote-link footnote-identifier-link" title="A complete description of the Mixture of Gaussian algorithm can be found in the article by C. Stauffer and W.E.L. Grimson, Adaptive background mixture models for real-time tracking, in Conf. on Computer Vision and Pattern Recognition, 1999.">2</a></sup>. It is basically an algorithm that extracts foreground objects in a scene while also coping with the problem of a moving background object (like tree leaves) or a glaring effect, thanks to sophisticated additions (e.g. the running variance is also considered on top of the running average for a model &#8211; so more data are kept and analyzed). This might be used in our case, even with a moving camera, but this would means that we make sure to keep flying and moving over a regular, flat, featureless and uni-color/pattern ground.</li>
</ul>
<ul>
<li style="text-align: justify;"><strong>Template matching method</strong>. It enables the detection of a specific pattern or part of a bigger image by looking for matches between the analyzed image and another, smaller image &#8211; the template, that contains the object we are trying to find. It does so by sliding the template over the image, going from the top left to the bottom right corner. The drawback of this solution is that is does not automatically take possible rotations of the object to match into account, nor does it consider the scaling of the object that changes depending on the altitude of the camera. Implementing those additional treatments would be possible but may be tedious and likely hardly efficient in terms of complexity (a naive algorithm would have to consider all the possible orientation over 360 degrees, on top of different template sizes&#8230;). Yet, if done correctly and providing a well thought template, this may become a really elegant solution, because it would rely on a bare minimum of external environmental factors.</li>
</ul>
<ul>
<li style="text-align: justify;"><strong>Color detection and tracking</strong> looks for specific colors in an image. This methods removes all the colors that are not wanted, so as to only keep the color we need to locate, by applying different color filters on each image. This is frame-independent, i.e. it does not require to keep a trace in memory of what happened before, which is a positive aspect since frames may have almost nothing in common depending on the movements of the drone. This is however a surrounding-light sensitive solution, which means that results will vary depending on the daylight and lights that are turned on. So tuning might be often required before a new experiment.</li>
</ul>
<h3>Chosen technique</h3>
<p style="text-align: justify;">We have chosen tracking by color object detection, since this is a solution we knew could be implemented quickly with fair results. It may not be the best because of its important drawbacks, but our setup is such that those are mostly insignificant: we work in an office where light conditions greatly depend on ceiling lights, so we can keep a nearly constant lighting environment at all time. Besides, we do not need to track more than a few couples of robots, which mean that we can choose quite easily colors sharply contrasting with each other. Yet we are aware that this is no sustainable solution if we were to implement it on a greater scale in a different environment like outdoors, but image analysis is only one of our many concerns in this project, not our focus &#8211; so we could not afford to spend six months working on this topic alone.</p>
<p style="text-align: justify;">On top of that, we also learnt from other fellow students from Aarhus University, who faced a similar problem with an &#8220;eye-in-the-sky&#8221; static camera tracking two ground robots in real-time. They investigated many possible solutions and eventually disregarded all of them to choose the color detection. Yet they paid close attention to some of them, by even selecting first the Haar Classifier Cascades, that they did implement. However, this is an algorithm based on Machine Learning that requires a lot of &#8220;training&#8221; time, and performed badly in their setup, with unworkable results. Since our working environment is almost the same as theirs, with the same kind of hardware that is visually complex (LEGO studs are seen during the training of the machine with clear, clean pictures, but the video stream is much more noisy, and in our case even distorted by the inclination of the drone &#8211; so the same pattern on a picture may not be recognized in a video), and with the same software library OpenCV, it made a lot of sense to follow their track and try to build on what has been already done. All the details are available in their labreport<sup><a href="#footnote_2_907" id="identifier_2_907" class="footnote-link footnote-identifier-link" title="Hammer Slammer LEGO Game - Harald Andertun, Tom Oersnes Thorgaard, Mark Surrow:&nbsp;http://legologbook.blogspot.com/">3</a></sup>.</p>
<p style="text-align: justify;">This academic work, a recipe book for OpenCV<sup><a href="#footnote_3_907" id="identifier_3_907" class="footnote-link footnote-identifier-link" title="OpenCV 2 Computer Vision Application Programming Cookbook&nbsp;(Paperback) by Robert Laganiere, Packt Publishing Limited -&nbsp;ISBN 13: 9781849513241&nbsp;ISBN 10: 1849513244">4</a></sup> and lessons from our former professor of image analysis<sup><a href="#footnote_4_907" id="identifier_4_907" class="footnote-link footnote-identifier-link" title="David Roussel, research professor working at the IBISC laboratory (http://www.lami.univ-evry.fr/) ">5</a></sup> provided us with plenty of inspiring ideas and practical ways to implement them.</p>
<h2 style="text-align: justify;">Color object tracking</h2>
<h3 style="text-align: justify;">Method and implementation</h3>
<p style="text-align: justify;"><em>As an aside, please keep in mind that our following explanation may be best understood by looking into our commented source code at the same time, available in our </em><a title="Links and Downloads" href="../../links-downloads/" target="_blank">Link &amp; Downloads</a><em> section. The most relevant file for the problem we analyze here is </em><code>ColorMatcher.cpp </code><em>(in folder </em><code>drone_app_code_sdk_1.7/application/Source/ColorMatching</code><em>).</em></p>
<p style="text-align: justify;"><em></em> Tracking a given object usually requires to proceed in two major distinct steps:</p>
<ol>
<li>Identify the object, by producing a binary image showing where certain objects of interest could be located. This can for instance be done by histogram back projection or by motion analysis.</li>
<li>Extract the objects contained in this binary collection, i.e. extract the connected components (shapes made of a set of connected pixels in a binary image).</li>
</ol>
<p style="text-align: justify;">Then it is a good practice habit to display some graphical information on the video stream so the user may visualize how the algorithm performs.</p>
<p style="text-align: justify;">Analyzing a video signal is pretty much similar to analyzing a single picture. Video signals are made of a sequence of images called frames, that are taken at a regular pace, the frame rate. Once the individual frames of a video have been extracted, methods to analyze them are no different from those applied to pictures, and the results are the same, as long as we do not overdo too much heavy processing to keep up with the frame rate.</p>
<p style="text-align: justify;">So for the remaining of our explanation, we do as though we deal with a single frame, given that we then repeat the same process forever (as long as the drone is running). Note that each frame is temporarily copied into another memory location: the copy will be analyzed by our algorithm, while the original will have some graphical information drawn on top of it every time we go through one loop for one color and we identify a color. If this is not done, then the drawing interferes with the detection algorithm, since it is then part of the frame. The original frame is shown to the user, while the copy is deleted once all the color have been tracked on the current frame.</p>
<h4 style="text-align: justify;">Identifying the colors</h4>
<p style="text-align: justify;">We try here to track the markers presented on Figure 1. Since we are only dealing with color matching in a first time, we pay no attention on any other characteristic of the marker (neither the shape nor the orientation are relevant).</p>
<p style="text-align: justify;">Basically, when the program is launched, it is initialized with some static configuration that provides the parameters needed to identify each robot. To keep the matter simple, we therefore have one robot associated with one range of color values, in a one to one relationship. During our further explanations, we will deal with only one robot/color,  since the process is repeated in the same way for every other color (the difference being the values of the parameters passed to our function).</p>
<p style="text-align: justify;">For one color, we create a temporary color mask that is going to be our binary image required for the next step. It first starts as an empty data structure of the same dimension as the original frame.</p>
<pre>IplImage* colorMask = cvCreateImage(
                        cvSize(
                          frame-&gt;width,
                          frame-&gt;height
                        ),
                        8, // image type (8 bits image)
                        1 // one single channel
                      );</pre>
<p style="text-align: justify;">Then we apply the following method on our frame:</p>
<pre>cvInRangeS(frameCopy,
           cvScalar(robot-&gt;B_val_min, robot-&gt;R_val_min, robot-&gt;G_val_min),
           cvScalar(robot-&gt;B_val_max, robot-&gt;R_val_max, robot-&gt;G_val_max),
           colorMask
);</pre>
<p style="text-align: justify;"><code>cvInRangeS</code> extracts all the pixels that are in the color range defined by the second and third parameters [lower and upper bound of the interval] and gives them a binary value of 1 that will be stored in the <code>colorMask</code> matrix, while all the other filtered-out pixel get a 0 value. A color is defined here by its Red, Green, Blue (RGB) composition, thus we need to specify three value for each bound of the interval. Therefore, one can assert that a robot is completely defined by 6 values.</p>
<h4 style="text-align: justify;">Extracting the objects</h4>
<p style="text-align: justify;">From now on we have our binary data structure filled, which we can use. Another temporary data structure is needed, that is going to hold a vector of contours. Initialization is done as follows:</p>
<pre>CvMemStorage* storage = cvCreateMemStorage();</pre>
<p style="text-align: justify;">OpenCV offers a simple function to extract the contours of the connected components of an image:</p>
<pre>int numberOfContours = cvFindContours(colorMask,      // our binary image from step 1.
                                      storage,        // a vector of contours
                                      &amp;first_contour  // a pointer to the first contour found
);</pre>
<p style="text-align: justify;">The input is our binary image previously obtained. The output is a vector of contours, with each contour being represented by a vector of <code>CvPoint</code>. The extraction is performed by an algorithm that systematically scans the image until a component is found. Then, it follows its contour from this starting point while marking the pixel on its border. Once the contour is fully found, the scanning resumes at the last position until it finds a new component.</p>
<p style="text-align: justify;">Then, we filter out some of the components we are sure we want to be eliminated, using some prior knowledge about the expected size of the object of interest. We therefore discard all the components whose bounding box is smaller than a defined size. A bounding box is the most compact way to represent a component in an image, defined as the upright rectangle of minimum size that contains the shape entirely. It cannot provide more information than the location of the object and an approximation of its size. That is the easiest structure to use for us, and is created in our code like this:</p>
<pre>cvRect bound = cvBoundingRect(storage[0], 0)</pre>
<p style="text-align: justify;">However, filtering all the small bounding boxes revealed to be insufficient to get eventually one unique box that could be identified as the wanted color/robot, because of some unexpected light noise that might appear on one frame or another. Hence our decision to only keep the biggest one (the noise is usually not covering a surface bigger than the robot itself).</p>
<h4 style="text-align: justify;">Displaying the objects</h4>
<p style="text-align: justify;">Finally, we draw all the bounding boxes we found on our original frame, except for those that are smaller than our threshold, as it displayed on Figure 2. Then we add a marker (a circle and a tag name) on what we consider to be the actual robot, that is, the biggest rectangle (cf. video 1 or Figure 3 for an illustration).</p>
<p style="text-align: justify;">Once our analyze is done for one frame and one color, we obviously do not forget to reset and release the temporarily allocated memory chunk to avoid a memory overflow that can happen really quickly when it comes to deal with a video signal:</p>
<pre>cvClearMemStorage(storage);
cvReleaseMemStorage(&amp;storage);
first_contour = NULL;
cvReleaseImage(&amp;colorMask);</pre>
<p style="text-align: justify;">We also draw a direction vector that make averages on the last ten registered positions for each robot, so we can get a new information on the overall direction of a unit.</p>
<p style="text-align: justify;">Obviously, while drawing our bounding boxes, we also update the corresponding robot structure with its newly found coordinates. We convert the matrix coordinates into real measurements by applying the same calculations that we already did with the drone and one roundel<sup><a href="#footnote_5_907" id="identifier_5_907" class="footnote-link footnote-identifier-link" title="Tracking algorithm: considering the inclination of the drone, Situation Modeling: http://www.ludep.com/tracking-algorithm-considering-the-inclination-of-the-drone">6</a></sup> (it basically consists in multiplying our value by a MAPPING_SCALE parameter that depends on the altitude of the camera and its Field Of View angle). Automatically, the new position of the robot is sent to the server that manages the flock.</p>
<p>&nbsp;</p>
<table class="aligncenter" width="534" align="center">
<tbody>
<tr>
<td><a href="../wp-content/uploads/2011/08/MultiBlob_4colors_cropped.png"><img class="aligncenter size-full wp-image-904" title="MultiBlob_4colors_cropped" src="../wp-content/uploads/2011/08/MultiBlob_4colors_cropped.png" alt="" width="534" height="494" srcset="../wp-content/uploads/2011/08/MultiBlob_4colors_cropped.png 835w, ../wp-content/uploads/2011/08/MultiBlob_4colors_cropped-300x277.png 300w, ../wp-content/uploads/2011/08/MultiBlob_4colors_cropped-100x92.png 100w" sizes="(max-width: 534px) 100vw, 534px" /></a></td>
</tr>
<tr>
<th style="text-align: justify;"><strong>Figure 2</strong>: Detection of multiple objects at the same time. This is our main interface that enables us to test and see what happens in real-time, by providing tools to tune parameters &#8220;on the go&#8221;.  The left window is the user input interface, the top right window displays the video with a matching colors overlay, and the small bottom right window currently displays the extracted contours corresponding to our red color.</th>
</tr>
</tbody>
</table>
<p>&nbsp;</p>
<p style="text-align: justify;">The Graphical User Interface provides the user with some liberty in adjusting the parameters in real-time:</p>
<ul>
<li style="text-align: justify;"><strong>Field edge size</strong> is the size of the virtual border all-around the image that triggers a specific signal once a robot is in its boundaries. This is later used by the server and the leader that will try to prevent robots to escape the field of view as often as possible.</li>
<li style="text-align: justify;"><strong>Cam distance</strong> is the distance from the camera to the ground. This is actually only used with a webcam on the ceiling (see below), and is updated automatically when the drone is used (thanks to its sensors).</li>
<li style="text-align: justify;"><strong><strong>Position filter threshold</strong> </strong>is the minimum distance that has to be between two components before considering them as two different objects.</li>
<li style="text-align: justify;"><strong>Bound min size</strong> is the minimum size of one side of a bounding box so that its inner component is considered as a potential robot.</li>
<li style="text-align: justify;"><strong>Smoothing (Gaussian)</strong> applies a filter that blurs the image. This is a convenient way of getting rid of noise inside frames that has otherwise a tendency to produce lots of small, scarce components. It is thus practically always kept active.</li>
<li style="text-align: justify;"><strong>Require convex shapes</strong> can be activated to disregards all the components that are not convex. Given the lack of absolute precision in the detection, it is rare that components are always perfectly enclosed object, so this is probably too selective a parameter.</li>
<li style="text-align: justify;"><strong>Socket I/O</strong> enables or disables communication with a server. <em>(more about that feature in our project&#8217;s report)</em></li>
<li style="text-align: justify;"><strong>Video</strong> opens a window that displays the video signal in real-time, with the graphical overlay.</li>
<li style="text-align: justify;"><strong>Log</strong> is used for debugging: if activated, it prints debug and information messages in real-time into the console.</li>
<li style="text-align: justify;"><strong>PanelR#</strong> opens or closes the settings window for a given robot. This new panel allows the user to change separately one of the 6 color parameters (i.e. the RGB interval boundaries), in real-time. It also enables another video view where is solely shown the computed contours (the <code>storage</code> vector) for the associated color.</li>
</ul>
<h3>Experiments</h3>
<h4>One steady webcam setup</h4>
<p style="text-align: justify;">In order to not over complicate the testing of this part of our project, we decided to first test our recognition algorithm with an USB webcam attached to the ceiling and facing down toward our testing field, before connecting it to our drone and dealing with the hassle of flying it altogether. We also ran a simple server locally which task was merely to print out the messages -containing the robots coordinates- sent by our detection class.</p>
<p style="text-align: justify;">This webcam has a higher resolution of 640*480 pixels than the vertical one embedded in the drone (176 * 144 pixels). This entails a higher accuracy in what was observed, but also a major slowdown in the processing time. Actually, the laptop we use for this purpose is getting old and is not able in itself to just correctly display the video stream at a good frame rate and lag-free. While this was not an issue to test the basic mechanics of our algorithm, and to see that the color detection was efficient enough for our purpose, it quickly became a problem when we introduced communication with the robots, since they were not able to react to their current state, and rather moved accordingly to already obsolete results.</p>
<p style="text-align: justify;">That is the reason why we later thought about an intermediate solution that consists in hanging the drone on the ceiling by the means of strings, and then establish a WiFi connection with it without starting its motors, in order to get its video signal. This enabled us to tune our algorithm even better and approach our final system step by step. Besides, what we lost in resolution was gained in terms of frame rate, computing time and greater field of view (64 degrees instead of 52 degrees, which is a nice improvement given our rather low ceiling).</p>
<p style="text-align: justify;">We therefore created a class that can be instantiated for both configurations, depending on the available setup and current needs. This <code>ColorMatcher</code> class handle then all the color detection algorithm, server communication and Graphical User Interface (GUI) by itself. The following piece of code is enough to launch all the threads that manage those tasks:</p>
<pre>ColorMatcher* colorMatcher = new ColorMatcher(true // use the webcam rather than the drone's camera
                                              true // start by displaying the video signal (GUI adjustable)
IplImage* frame;

while ( (frame = colorMatcher-&gt;getCurrentFrame()) != NULL)
{
    colorMatcher-&gt;analyzeFrame(frame);
}</pre>
<h4>One robot</h4>
<p style="text-align: justify;">Starting with one robot, i.e. one color, was a good way to learn how to tune our parameters. A good start is to identify the RGB code of the tag we consider by comparing it to samples in an online database if necessary, then to create a first interval of minimum and maximum boundaries by substracting or adding a constant to those RGB values. Then, watching the color mask evolving in real-time on the screen enables a quick and efficient tuning, usually by tweaking only one or two more parameters, using sliders of the GUI.</p>
<p style="text-align: justify;">Results went better than expected because of the really good detection speed and the fairly stable performances we observed (cf. Video 1). Surely, if we were to turn off at least one light in the room would the results be different with plenty of noise and false positives. Light sensitivity is the obvious drawback of this system.</p>
<table class="aligncenter" width="420" align="center">
<tbody>
<tr>
<td><object width="420" height="345" classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" codebase="http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=6,0,40,0"><param name="allowFullScreen" value="true" /><param name="allowscriptaccess" value="always" /><param name="src" value="http://www.youtube.com/v/R2yafY4n3QE?version=3&amp;hl=en_US" /><param name="allowfullscreen" value="true" /><embed width="420" height="345" type="application/x-shockwave-flash" src="http://www.youtube.com/v/R2yafY4n3QE?version=3&amp;hl=en_US" allowFullScreen="true" allowscriptaccess="always" allowfullscreen="true" /></object></td>
</tr>
<tr>
<th>
<p style="text-align: justify;"><strong>Video 1:</strong> The robot&#8217;s behavior has no special meaning &#8211; it&#8217;s merely a test with a still webcam ofgood resolution that is used to detect specific colors on the ground. The control window on the right (mostly black) shows what happens on the algorithm side when we want to detect the red color.</p>
<p style="text-align: justify;">Coordinates and values returned by the algorithm (for further used by the ground robots) are displayed in the console on the bottom right.</p>
</th>
</tr>
</tbody>
</table>
<p>&nbsp;</p>
<h4><code>N</code> robots</h4>
<p style="text-align: justify;">Going from one robot to <code>n</code> robots has being made an easy task in our class. At any time, one just needs to add the following line into the program to tell it that it should now also watch for a new range of color and handle a new robot.</p>
<pre>colorMatcher-&gt;addRobot(B_val_min, G_val_min, R_val_min, B_val_max, G_val_max, R_val_max);</pre>
<p style="text-align: justify;">The more the robots we have, the harder it is to find colors that can be easily distinguished if we want to deal with slight lighting variations. Still, we did not have any issue with four colors (the highest number we could test here, due to the material limitation we have with the number of robots we could possibly build), as it is shown in Figure 3.</p>
<p style="text-align: justify;">The complexity of our algorithm being nothing more than linear (<code>O(n)</code>)  in terms of the number of robots and not quadratic or worse, we did not expect, nor did we observe, a longer computational time and a performance loss. Actually, the algorithm keeps being executed faster than the frame rate. Video 2 is here to illustrate the performance of our color detection program for multiple robots.</p>
<table class="aligncenter" width="720" align="center">
<tbody>
<tr>
<td style="vertical-align: middle;"><a href="../wp-content/uploads/2011/08/Flock_4Robots_cropped.png"><img class="aligncenter size-medium wp-image-951" title="Flock_4Robots" src="../wp-content/uploads/2011/08/Flock_4Robots_cropped-300x267.png" alt="" width="300" height="267" srcset="../wp-content/uploads/2011/08/Flock_4Robots_cropped-300x267.png 300w, ../wp-content/uploads/2011/08/Flock_4Robots_cropped-100x89.png 100w, ../wp-content/uploads/2011/08/Flock_4Robots_cropped.png 675w" sizes="(max-width: 300px) 100vw, 300px" /></a></td>
<td><object width="420" height="345" classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" codebase="http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=6,0,40,0"><param name="allowFullScreen" value="true" /><param name="allowscriptaccess" value="always" /><param name="src" value="http://www.youtube.com/v/inOph-wTeh4?version=3&amp;hl=en_US" /><param name="allowfullscreen" value="true" /><embed width="420" height="345" type="application/x-shockwave-flash" src="http://www.youtube.com/v/inOph-wTeh4?version=3&amp;hl=en_US" allowFullScreen="true" allowscriptaccess="always" allowfullscreen="true" /></object></td>
</tr>
<tr>
<th style="text-align: justify;"><strong>Figure 3</strong>: Detection of four objects at the same time. Notice how the resolution has changed compared to video 1, due to a switch from a webcam to the drone&#8217;s camera. This is also the best field of view we can hope to have in our testing room: the drone is about 270 cm high, providing a FOV of around 180*220 cm².</th>
<th style="text-align: justify;"><strong>Video 2</strong>: Detection of four objects in real-time. The color location is quite steady on a whole run. Still, this video illustrates some consequences of non precise tuning, where Robot#4 (yellow) is once mistaken for Robot#1 (red), which can lead to wrong behaviors.Observe also (solved) issues with green detection: some parts of the floor are sometimes seen as green, but since they are always small in size, the algorithm never confuses them for Robot#3 &#8211; as long as it is on the field.</th>
</tr>
</tbody>
</table>
<p>&nbsp;</p>
<h4>Experimenting with different surroundings</h4>
<p style="text-align: justify;">We have tried our whole system with the drone&#8217;s camera and four robots in another environment (our LEGOlab, Zuze building, in Aarhus), where the place is well-lit by the daylight and the floor is mostly a blue carpet. Results were poor compared to what we get in our own office, that consists in a light gray floor and is mostly influenced by indoors lights. Basically, the blue carpet triggered a bad detection quality by greatly decreasing  the contrast with our own markers. Unsurprisingly, the red one was still quite well detected, while all the other colors appeared almost white on the screen. That is due to the camera that overcompensates the relative prevailing darkness of the blue carpet by making anything else much brighter in contrast, to the point where it is hard to tell the difference between our already bright, blue, green and yellow colors. It was really obvious once we get a white shirt of one of us appearing in the field of view: after a couple of seconds of adaptation, the detection was back to being nearly perfect again, whereas the blue carpet was still prevalent. This is explained by the fact that this shirt provided a new element of sharp contrast with the remaining of the image, which was then compensated the other way around by the camera. The ambient bright daylight was also not here to help it, because of the somewhat reflective surface of our tags and the noise generated on the video signal.</p>
<h3>Results with the drone</h3>
<h4>Tests</h4>
<p style="text-align: justify;">Dealing with a moving drone is supposed to complicate the detection for the worse. Surprisingly, once the color parameters are tuned, the detection keeps being smooth &#8211; and nothing is slow down (neither the tracking algorithm nor the drone&#8217;s control algorithm).</p>
<p style="text-align: justify;">The increase or decrease of distance from the camera to the field did not have any noticeable effect on our detection, as long as the drone does not go beyond an altitude of around four meters, in which case it would require bigger tags (or a higher-resolution camera). Besides, quick movements and large inclinations of the drone were not affecting our tracking. We also feared that the shadow cast by the drone itself on the ground would cause visible issues, but none was to be reported. Coordinates sent were still consistent in the own relative camera coordinates system, which helped efficiently the robots to position themselves on the field <em>(more on this topic in another article, and lots of example videos of the whole system in our Youtube channel)</em>.</p>
<h4 style="text-align: justify;">Improvements</h4>
<p style="text-align: justify;">One improvement that may be however considered to add more flexibility to the use of our drone, by making it less light-dependent, may lie in the polygonal approximation of a component&#8217;s contour, instead of its rough bounding box. This way, we could detect shapes instead of colors -like one regular polygon for one robot-, while still keeping almost all our algorithm. Color detection would still be used but with a much broader and permissive interval, insofar as we would not have to differentiate the robot&#8217;s colors between each other, and contour detection would also be applied. We would then need to change a few lines of code while changing the bounding rectangles to a creation of a new polygon, which would be close to this:</p>
<pre>std::vector poly;  // the polygon we want to create from the contour
cvApproxPolyDP(cv::Mat(storage[0]),
               poly,
               5,      // accuracy of the approximation
               true    // yes it is a closed shape
);</pre>
<p style="text-align: justify;">And after that, we could identify the polygon by counting the number of its sides. NB: the convex hull is another form of polygonal approximation that may also be worth considering.</p>
<p style="text-align: justify;">We have already tried the component detection with a broader color interval, and it revealed to be really efficient in the task of differentiating the robots from the other elements on the ground, most likely because of the bright colors that were used as markers. We however lacked time to implement the remaining of the polygon detection (and it was not also absolutely necessary since we achieved our main goal without it), but we believe it to be a sustainable solution, even though we are still not fully assured of its success, because of the low resolution of the camera that would certainly make this impossible if the objects were too small.</p>
<p style="text-align: justify;">A possible alternative would be a mix between color detection and template matching, by tracking the robot using template matching, Kalman filtering and color-histogram back-projection. Templates of robots would still be extracted from our color mask using connected component extraction. New locations would be predicted by a Kalman filter. The template matching would be a nice added feature to our algorithm, since it would then provide it with more flexibility and a self calibrating process. This method was used to track soccer players and a ball in a football game, that can be applied in real-time with a good efficiency<sup><a href="#footnote_6_907" id="identifier_6_907" class="footnote-link footnote-identifier-link" title="Sunghoon Choi, Yongduek Seo, Hyunwoo Kim, Ki-Sang Hong,&nbsp;Where are the ball and players?: Soccer game analysis with color-based tracking and image mosaik">7</a></sup>. This is a situation quite similar to our issue, where we need to keep track of different elements belonging to the same team and moving on a two-dimensional field.</p>
<p>&nbsp;<br />
<b>References</b></p>
<ol class="footnotes">
<li id="footnote_0_907" class="footnote">Article by <em>B. Lucas and T. Kanade, an iterative image registration technique with an application to stereo vision in Int. Joint Conference in Artificial Intelligence, pp. 674-680, 1981</em>, describing the original feature point tracking algorithm. [<a href="#identifier_0_907" class="footnote-link footnote-back-link">&#8617;</a>]</li>
<li id="footnote_1_907" class="footnote">A complete description of the Mixture of Gaussian algorithm can be found in the article by <em>C. Stauffer and W.E.L. Grimson, Adaptive background mixture models for real-time tracking, in Conf. on Computer Vision and Pattern Recognition, 1999</em>. [<a href="#identifier_1_907" class="footnote-link footnote-back-link">&#8617;</a>]</li>
<li id="footnote_2_907" class="footnote">Hammer Slammer LEGO Game &#8211; Harald Andertun, Tom Oersnes Thorgaard, Mark Surrow: <a href="http://legologbook.blogspot.com/" onclick="__gaTracker('send', 'event', 'outbound-article', 'http://legologbook.blogspot.com/', 'http://legologbook.blogspot.com/');">http://legologbook.blogspot.com/</a> [<a href="#identifier_2_907" class="footnote-link footnote-back-link">&#8617;</a>]</li>
<li id="footnote_3_907" class="footnote"><em>OpenCV 2 Computer Vision Application Programming Cookbook</em> (Paperback) by Robert Laganiere, Packt Publishing Limited &#8211;<strong> ISBN 13</strong>: 9781849513241 <strong>ISBN 10</strong>: 1849513244 [<a href="#identifier_3_907" class="footnote-link footnote-back-link">&#8617;</a>]</li>
<li id="footnote_4_907" class="footnote">David Roussel, research professor working at the IBISC laboratory (<a href="http://www.lami.univ-evry.fr/" onclick="__gaTracker('send', 'event', 'outbound-article', 'http://www.lami.univ-evry.fr/', 'http://www.lami.univ-evry.fr/');">http://www.lami.univ-evry.fr/</a>)  [<a href="#identifier_4_907" class="footnote-link footnote-back-link">&#8617;</a>]</li>
<li id="footnote_5_907" class="footnote">Tracking algorithm: considering the inclination of the drone, Situation Modeling: <a href="../../tracking-algorithm-considering-the-inclination-of-the-drone/" target="_blank">http://www.ludep.com/tracking-algorithm-considering-the-inclination-of-the-drone</a> [<a href="#identifier_5_907" class="footnote-link footnote-back-link">&#8617;</a>]</li>
<li id="footnote_6_907" class="footnote"><em>Sunghoon Choi, Yongduek Seo, Hyunwoo Kim, Ki-Sang Hong, <a href="http://www.google.dk/url?sa=t&amp;source=web&amp;cd=1&amp;ved=0CBQQFjAA&amp;url=http%3A%2F%2Fciteseerx.ist.psu.edu%2Fviewdoc%2Fdownload%3Fdoi%3D10.1.1.31.3849%26rep%3Drep1%26type%3Dpdf&amp;ei=an5STr2IMo7CswaprNmLAw&amp;usg=AFQjCNFWRNwnT9LPb6gk-KQy3IU2pSP0OA&amp;sig2=PyvYmiBQR3yIYACUUV93wg" onclick="__gaTracker('send', 'event', 'outbound-article', 'http://www.google.dk/url?sa=t&amp;source=web&amp;cd=1&amp;ved=0CBQQFjAA&amp;url=http%3A%2F%2Fciteseerx.ist.psu.edu%2Fviewdoc%2Fdownload%3Fdoi%3D10.1.1.31.3849%26rep%3Drep1%26type%3Dpdf&amp;ei=an5STr2IMo7CswaprNmLAw&amp;usg=AFQjCNFWRNwnT9LPb6gk-KQy3IU2pSP0OA&amp;sig2=PyvYmiBQR3yIYACUUV93wg', 'Where are the ball and players?: Soccer game analysis with color-based tracking and image mosaik');" title="Article (pdf)"  target="_blank">Where are the ball and players?: Soccer game analysis with color-based tracking and image mosaik</a></em> [<a href="#identifier_6_907" class="footnote-link footnote-back-link">&#8617;</a>]</li>
</ol>
<div class='shareaholic-canvas' data-app-id='17416102' data-app='recommendations' data-title='Image analysis: color detection for multiple robots' data-link='https://www.ludep.com/image-analysis-color-detection-for-multiple-robots/' data-summary=''></div>		</div>
		<div class="clear"></div>
		
	</div>
		<div id="post-773" class="post post-773 type-post status-publish format-standard has-post-thumbnail hentry category-drone category-ideas category-issues category-programming category-refining-the-project category-testing">
		<h2 class="h1"><a href="../../tracking-algorithm-considering-the-inclination-of-the-drone/" rel="bookmark">Tracking algorithm: considering the inclination of the drone</a></h2>

					<table class="info entry-meta">
				<tr>
					<td class="date">July 22, 2011</td>
					<td>
													<span class="postedby">
								Posted by <a href="http://michael/" title="Visit Michael&#8217;s website" rel="author external">Michael</a> 
							</span>
								<span class="filledunder">under</span>
												<span class="filledunder">
							<a href="" rel="category tag">Drone</a>, <a href="../ideas/" rel="category tag">Ideas</a>, <a href="../issues/" rel="category tag">Issues</a>, <a href="../programming/" rel="category tag">Programming</a>, <a href="../refining-the-project/" rel="category tag">Refining the project</a>, <a href="../testing/" rel="category tag">Testing</a>						</span>
					</td>
											<td>
						
				
							<div class="act">
																	<span class="comments">Comments off</span>
																							</div>
						</td>
					
				</tr>
			</table>
				
									
		
		
		<div class="content">
			
			<div style="float:right;padding: 0 0 10px 10px" class="interactive_right"><iframe allowtransparency="true" frameborder="0" scrolling="no" src="http://platform.twitter.com/widgets/tweet_button.html?url=https%3A%2F%2Fwww.ludep.com%2Ftracking-algorithm-considering-the-inclination-of-the-drone%2F&amp;text=Tracking%20algorithm:%20considering%20the%20inclination%20of%20the%20drone&amp;count=vertical&amp;lang=" style="width:65px; height:65px;"></iframe><iframe src="http://www.facebook.com/plugins/like.php?href=https%3A%2F%2Fwww.ludep.com%2Ftracking-algorithm-considering-the-inclination-of-the-drone%2F&amp;layout=box_count&amp;show_faces=false&amp;width=65&amp;action=like&amp;font=arial&amp;colorscheme=light&amp;height=65" scrolling="no" frameborder="0" style="border:none; overflow:hidden; width:65px; height:65px;" allowTransparency="true"></iframe></div><h2>Setting down the problem</h2>
<p style="text-align: justify;">Our PID controller has proven to be working but without achieving an almost perfect stability, even when it comes to stay on top of a still roundel. A hypothesis was then made to explain our difficulty to fulfill our goal, apart from having to correctly tune the gain parameters. So far, we have not taken into account the fact that the drone tilts a little while it moves. Yet, an inclination on one or two axis moves also the vertical camera, which then changes the roundel position returned by our algorithm.</p>
<p style="text-align: justify;">Indeed, if the drone is located of top of the same spot where there is a roundel, the coordinates returned will vary more or less depending on the tilt angle. The greater the tilting, the bigger the offset. And a PID controller cannot behaves well if its core principle, that is the parameter measured which has to be corrected, is changing in an unexpected way because of the results of the PID correction.</p>
<h2>Situation modeling</h2>
<h3>Geometric representation</h3>
<p style="text-align: justify;">The figures below illustrate the problem that occurs while the drone is moving. First, Figure 1 pictures the ideal situation, where the camera keeps itself perfectly vertical at any time. The field of view (FOV) of the camera is represented by a 1000*1000 matrix whose size does not change accordingly to the altitude. The coordinates returned by the detection algorithm are therefore given without units (in blue on the picture) and only specify relatives distances. To apply our own correction, we will need to work with SI units. This will be possible by using the altitude value that the drone navigation data knows at any time, and the FOV angle, which is equal to 64 degrees.</p>
<p><a href="../wp-content/uploads/2011/07/CameraFOV_fig1_shrunk.png"><img class="aligncenter size-large wp-image-798" title="CameraFOV_Figure1" src="../wp-content/uploads/2011/07/CameraFOV_fig1_shrunk-949x1024.png" alt="" width="640" height="690" srcset="../wp-content/uploads/2011/07/CameraFOV_fig1_shrunk-949x1024.png 949w, ../wp-content/uploads/2011/07/CameraFOV_fig1_shrunk-278x300.png 278w, ../wp-content/uploads/2011/07/CameraFOV_fig1_shrunk-92x100.png 92w" sizes="(max-width: 640px) 100vw, 640px" /></a></p>
<p>&nbsp;</p>
<p style="text-align: justify;">Figure 2 shows how tilting the vertical camera distorts the coordinate system on the ground. Furthermore, the roundel is clearly not at the same location anymore when it is viewed from the drone viewpoint, whereas the drone and the roundel are still over the same spot.</p>
<p>&nbsp;</p>
<p><a href="../wp-content/uploads/2011/07/CameraFOV_fig2_shrunk.png"><img class="aligncenter size-large wp-image-799" title="CameraFOV_Figure2" src="../wp-content/uploads/2011/07/CameraFOV_fig2_shrunk-952x1024.png" alt="" width="640" height="688" srcset="../wp-content/uploads/2011/07/CameraFOV_fig2_shrunk-952x1024.png 952w, ../wp-content/uploads/2011/07/CameraFOV_fig2_shrunk-278x300.png 278w, ../wp-content/uploads/2011/07/CameraFOV_fig2_shrunk-92x100.png 92w" sizes="(max-width: 640px) 100vw, 640px" /></a></p>
<p>&nbsp;</p>
<p style="text-align: justify;">On Figure 3, it is possible to see that the inclination angle and the position of the roundel may affect the representation of the situation: the subsequent angles are not calculated as in the previous case. All those figures are obviously symmetrical, and what happens on one side of the x axis happens the same way on the other side.</p>
<p>&nbsp;</p>
<p><a href="../wp-content/uploads/2011/07/CameraFOV_fig3_shrunk.png"><img class="aligncenter size-large wp-image-800" title="CameraFOV_Figure3" src="../wp-content/uploads/2011/07/CameraFOV_fig3_shrunk-949x1024.png" alt="" width="640" height="690" srcset="../wp-content/uploads/2011/07/CameraFOV_fig3_shrunk-949x1024.png 949w, ../wp-content/uploads/2011/07/CameraFOV_fig3_shrunk-278x300.png 278w, ../wp-content/uploads/2011/07/CameraFOV_fig3_shrunk-92x100.png 92w" sizes="(max-width: 640px) 100vw, 640px" /></a></p>
<p style="text-align: justify;">The goal is now to analyse all these possible cases and find a corrective function that can be applied to the coordinate thats the algorithm receives, no matter what they are.</p>
<h3>Mathematical analysis</h3>
<p style="text-align: justify;">First, we need a function that returns a converting factor that will be used to transform a value into millimeters from a measurement given in arbitrary units (as returned by the embedded algorithm on the drone).</p>
<p><a href="../wp-content/uploads/2011/07/1.png"><img class="aligncenter size-full wp-image-774" title="1" src="../wp-content/uploads/2011/07/1.png" alt="" width="277" height="58" srcset="../wp-content/uploads/2011/07/1.png 277w, ../wp-content/uploads/2011/07/1-100x20.png 100w, ../wp-content/uploads/2011/07/1-270x58.png 270w" sizes="(max-width: 277px) 100vw, 277px" /></a></p>
<p style="text-align: justify;">Then, when we need to convert a value read by the camera into millimeters at a given altitude, we just need to apply the following:</p>
<p style="text-align: justify;"><a href="../wp-content/uploads/2011/07/2.png"><img class="aligncenter size-full wp-image-775" title="2" src="../wp-content/uploads/2011/07/2.png" alt="" width="257" height="42" srcset="../wp-content/uploads/2011/07/2.png 257w, ../wp-content/uploads/2011/07/2-100x16.png 100w" sizes="(max-width: 257px) 100vw, 257px" /></a></p>
<p>With                                                                            <a href="../wp-content/uploads/2011/07/3.png"><img class="aligncenter size-full wp-image-776" title="3" src="../wp-content/uploads/2011/07/3.png" alt="" width="172" height="38" srcset="../wp-content/uploads/2011/07/3.png 172w, ../wp-content/uploads/2011/07/3-100x22.png 100w" sizes="(max-width: 172px) 100vw, 172px" /></a></p>
<p style="text-align: justify;">To keep our explanation simple, we take only two dimensions into account, that are the height and a length along the x axis. The reasoning and calculus are exactly the same with the y axis, apart from one minus sign.</p>
<p style="text-align: justify;">Let us now consider a tilted camera that makes a φ angle with a vertical line perpendicular to the ground. Figure 2.b illustrates the problem we have to solve: even if neither the roundel nor the drone have moved -except for the tilting-, the coordinates returned by the tracking algorithm will be much different from what is expected (Figure 1.b).</p>
<p style="text-align: justify;">The value <em>xRead </em> returned by the camera is not actually the one corresponding to the real distance as seen on the ground, since the scale on the projected field of view on the ground is now distorted because of the tilting. To keep an orthonormal coordinate system with evenly scaled values, we have to consider a plane perpendicular to the line that go straight into the camera lens. Then, no matter where this plane is located along this line, every single point that belongs to this newly enclosed space will keep the same <em>relative</em> distance to the origin zero.</p>
<p style="text-align: justify;">We define a new angle α as showed on Figure 2.a, such as:</p>
<p><a href="../wp-content/uploads/2011/07/4.png"><img class="aligncenter size-full wp-image-778" title="4" src="../wp-content/uploads/2011/07/4.png" alt="" width="188" height="66" srcset="../wp-content/uploads/2011/07/4.png 188w, ../wp-content/uploads/2011/07/4-100x35.png 100w" sizes="(max-width: 188px) 100vw, 188px" /></a></p>
<p style="text-align: justify;">We also define <em>xReal</em> as the actual position of the roundel on the x-axis in a situation where the camera is perfectly vertical.</p>
<p style="text-align: justify;"><a href="../wp-content/uploads/2011/07/5.png"><img class="aligncenter size-full wp-image-780" title="5" src="../wp-content/uploads/2011/07/5.png" alt="" width="177" height="40" srcset="../wp-content/uploads/2011/07/5.png 177w, ../wp-content/uploads/2011/07/5-100x22.png 100w" sizes="(max-width: 177px) 100vw, 177px" /></a></p>
<p style="text-align: justify;">Where                                                                        <a href="../wp-content/uploads/2011/07/6.png"><img class="aligncenter size-full wp-image-781" title="6" src="../wp-content/uploads/2011/07/6.png" alt="" width="173" height="40" srcset="../wp-content/uploads/2011/07/6.png 173w, ../wp-content/uploads/2011/07/6-100x23.png 100w" sizes="(max-width: 173px) 100vw, 173px" /></a> And <em>xOut_1||2</em>  is the equivalent of <em>xRead</em> distorted on the ground (one cannot talk about “projection” since not perpendicular angle is considered there). The value of <em>xOut_1||2</em> is actually different depending on the camera inclination and the roundel location (Figure 2.a involves <em>xOut_1</em>, Figure 3.a shows <em>xOut_2</em>) . Keep in mind that <em>xRead</em>, <em>xReal</em>, <em>xIn</em> and <em>xOut</em> can be negative depending on the tilt angle φ. Besides, the value φ is returned positive by the drone navigation data when the drone is in a situation likewise to Figure 2.a, and negative when the tilting is in the opposite direction. Using the law of sines<sup><a href="#footnote_0_773" id="identifier_0_773" class="footnote-link footnote-identifier-link" title="http://en.wikipedia.org/wiki/Law_of_sines">1</a></sup>, that states that the ratio of the length of a side to the sine of its corresponding opposite angle is constant, we get, from the green triangle in Figure 2.a: <a href="../wp-content/uploads/2011/07/7.png"><img class="aligncenter size-full wp-image-782" title="7" src="../wp-content/uploads/2011/07/7.png" alt="" width="184" height="63" srcset="../wp-content/uploads/2011/07/7.png 184w, ../wp-content/uploads/2011/07/7-100x34.png 100w" sizes="(max-width: 184px) 100vw, 184px" /></a>And since <a href="../wp-content/uploads/2011/07/8.png"><img class="aligncenter size-full wp-image-783" title="8" src="../wp-content/uploads/2011/07/8.png" alt="" width="151" height="39" srcset="../wp-content/uploads/2011/07/8.png 151w, ../wp-content/uploads/2011/07/8-150x39.png 150w, ../wp-content/uploads/2011/07/8-100x25.png 100w" sizes="(max-width: 151px) 100vw, 151px" /></a> We get                                                                        <a href="../wp-content/uploads/2011/07/9.png"><img class="aligncenter size-full wp-image-784" title="9" src="../wp-content/uploads/2011/07/9.png" alt="" width="207" height="43" srcset="../wp-content/uploads/2011/07/9.png 207w, ../wp-content/uploads/2011/07/9-100x20.png 100w" sizes="(max-width: 207px) 100vw, 207px" /></a> The same goes with <em>xOut_2</em>, except that the angles are different (cf. Figure 3.a): <a href="../wp-content/uploads/2011/07/10.png"><img class="aligncenter size-full wp-image-785" title="10" src="../wp-content/uploads/2011/07/10.png" alt="" width="191" height="63" srcset="../wp-content/uploads/2011/07/10.png 191w, ../wp-content/uploads/2011/07/10-100x32.png 100w" sizes="(max-width: 191px) 100vw, 191px" /></a> Hence the result that applies in a case similar to Figure 2.a: <a href="../wp-content/uploads/2011/07/11.png"><img class="aligncenter size-full wp-image-786" title="11" src="../wp-content/uploads/2011/07/11.png" alt="" width="363" height="60" srcset="../wp-content/uploads/2011/07/11.png 363w, ../wp-content/uploads/2011/07/11-300x49.png 300w, ../wp-content/uploads/2011/07/11-100x16.png 100w" sizes="(max-width: 363px) 100vw, 363px" /></a> When we generalize the calculus and consider every possible situation, we get the following conclusion: <a href="../wp-content/uploads/2011/07/12.png"><img class="aligncenter size-full wp-image-787" title="12" src="../wp-content/uploads/2011/07/12.png" alt="" width="724" height="160" srcset="../wp-content/uploads/2011/07/12.png 724w, ../wp-content/uploads/2011/07/12-300x66.png 300w, ../wp-content/uploads/2011/07/12-100x22.png 100w, ../wp-content/uploads/2011/07/12-270x60.png 270w" sizes="(max-width: 724px) 100vw, 724px" /></a></p>
<h3>Experiments and performance results</h3>
<h4 style="text-align: justify;">Protocol</h4>
<p style="text-align: justify;">To test our model in a real world setup, we built and filled a datalog in real-time during different test flights to keep track of the raw values returned by the detection algorithm and the corrected values. Besides, we also saved the angles made by the drone on both axis. Again, to keep the results readable, we chose to display data referring only to the x-axis, so it makes sense to compare our previous data. We performed the same experiments on the y-axis, for the same performance.</p>
<p style="text-align: justify;">Both graphs below reports these data on the same timeline, during one of our running test times. Basically, we took the drone, activated our recognition algorithm, and did the following, in this order:</p>
<ol style="text-align: justify;">
<li>The drone is put on top of the roundel, at a steady altitude. We then rotate it around one axis at a regular pace, from one side to the other (no more than 60 degrees on each side), in order to register different lateral angles.</li>
<li>The drone is then put on the far right of the roundel, without changing the altitude nor the y axis position. Rotations are then applied as before.</li>
<li>Step 2 is repeated, except that it is done one the far left of the roundel.</li>
</ol>
<h4>Experiments</h4>
<p style="text-align: justify;">The experiment results are reported on the graphs below. Please note that values are actually registered when a roundel is detected. That is why the range of the angle vary for each step, even if the drone is each time moved the same way. The achieved results for these steps are:</p>
<div>
<ol>
<li style="text-align: justify;">As expected, the more the drone is tilted (in green on the graph), the further from the zero origin the roundel is detected (in blue on the graph). The corrected value (<em>xReal</em>) is staying really close to zero, which is what we wanted to perform.</li>
<li style="text-align: justify;">The corrected value stays close to the real one, with a range of 50 cm at maximum, way better than a range of 2 meters as it is the case with the raw values.</li>
<li style="text-align: justify;">Observed results are symmetrical to those of step 2.</li>
</ol>
</div>
<p><a href="../wp-content/uploads/2011/07/tilt_graphs.png"><img class="aligncenter size-large wp-image-788" title="tilt_graphs" src="../wp-content/uploads/2011/07/tilt_graphs-1024x437.png" alt="" width="640" height="273" srcset="../wp-content/uploads/2011/07/tilt_graphs-1024x437.png 1024w, ../wp-content/uploads/2011/07/tilt_graphs-300x128.png 300w, ../wp-content/uploads/2011/07/tilt_graphs-100x42.png 100w, ../wp-content/uploads/2011/07/tilt_graphs.png 1286w" sizes="(max-width: 640px) 100vw, 640px" /></a></p>
<h4 style="text-align: justify;">Closing comments</h4>
<p style="text-align: justify;">What can also be noted is that the sensors perform really well: they return accurate and consistent values at any time. This is especially true with the altitude, since the tilt sensors seem to lose accuracy when they are shaken too fast or if the angle is too big, which accounts for bigger errors in the correction. Overall, they all refresh themselves fast enough to be consistent with each other at a given time, and the communication delay does not really interfere with this process.</p>
<p style="text-align: justify;">As for the drone itself, once the correction is applied for the PID controller, we clearly noted that a lot of steadiness has been gained through this process, with a reduced settling time and a less random behavior. This itself confirmed the relevance of our study and the efficiency provided by the sensors and by our algorithm. We will soon provide new results about our tracking controller, with some further investigation into other solutions.</p>
<h2>Approximating our model</h2>
<h3>Simplification of the situation</h3>
<p style="text-align: justify;">The high mathematical precision that we got with our previous model is not required because the sensors do not allow for such precision. Hence a simplification may be welcome, be it only out of concern for maximum clarity in the explanation. Besides, it saves having to rely more than once on values returned by the sensors. If a sensor value is slightly offset, it is indeed better to use it once and for all in our equations, rather than reporting errors many times and increasing its effects on the results (especially here with the <em>altitude</em> and <em>xRead<sub>mm</sub></em> that were each called three times before, because of the α angle). Figure 4.a shows how the model can be simplified.</p>
<p><a href="../wp-content/uploads/2011/07/CameraFOV_fig4.png"><img class="aligncenter size-large wp-image-805" title="CameraFOV_Figure4" src="../wp-content/uploads/2011/07/CameraFOV_fig4-952x1024.png" alt="" width="640" height="688" srcset="../wp-content/uploads/2011/07/CameraFOV_fig4-952x1024.png 952w, ../wp-content/uploads/2011/07/CameraFOV_fig4-278x300.png 278w, ../wp-content/uploads/2011/07/CameraFOV_fig4-92x100.png 92w" sizes="(max-width: 640px) 100vw, 640px" /></a></p>
<p>&nbsp;</p>
<p style="text-align: justify;">We therefore have only one function to compute <em>xReal</em>, whose domain of definition is broader, because neither the tilting angle φ nor the sign of <em>xRead<sub>mm</sub></em> change the model anymore :</p>
<p style="text-align: center;" align="center"><a href="../wp-content/uploads/2011/07/13.png"><img class="aligncenter size-full wp-image-807" title="13" src="../wp-content/uploads/2011/07/13.png" alt="" width="122" height="61" srcset="../wp-content/uploads/2011/07/13.png 151w, ../wp-content/uploads/2011/07/13-150x76.png 150w, ../wp-content/uploads/2011/07/13-100x50.png 100w" sizes="(max-width: 122px) 100vw, 122px" /></a><a href="../wp-content/uploads/2011/07/14.png"><img class="aligncenter size-full wp-image-808" title="14" src="../wp-content/uploads/2011/07/14.png" alt="" width="429" height="55" srcset="../wp-content/uploads/2011/07/14.png 530w, ../wp-content/uploads/2011/07/14-300x38.png 300w, ../wp-content/uploads/2011/07/14-100x12.png 100w" sizes="(max-width: 429px) 100vw, 429px" /></a></p>
<h3>Performance</h3>
<p style="text-align: justify;">This alternative model performed surprisingly very well, insofar as we got on average a shift of about 2 millimeters between both models. It even appears on average more accurate when we are dealing with positions further from the roundel, that are critical ones since the angle is greater there, and the sensor accuracy worse. This is explained by the fact that this new equation is less sensitive to small variations of the parameters.</p>
<p style="text-align: justify;"><a href="../wp-content/uploads/2011/07/tilt_graphs_bothModel_comparison1.png"><img class="aligncenter size-large wp-image-833" title="tilt_graphs_bothModel_comparison" src="../wp-content/uploads/2011/07/tilt_graphs_bothModel_comparison1-1024x215.png" alt="" width="640" height="134" srcset="../wp-content/uploads/2011/07/tilt_graphs_bothModel_comparison1-1024x215.png 1024w, ../wp-content/uploads/2011/07/tilt_graphs_bothModel_comparison1-300x63.png 300w, ../wp-content/uploads/2011/07/tilt_graphs_bothModel_comparison1-100x21.png 100w, ../wp-content/uploads/2011/07/tilt_graphs_bothModel_comparison1.png 1292w" sizes="(max-width: 640px) 100vw, 640px" /></a></p>
<p>As a conclusion, we plan on keeping this last implementation because of its really good performance, both in terms of simplicity and accuracy.</p>
<p>&nbsp;</p>
<p>&nbsp;&nbsp;<br />
<b>References</b></p>
<ol class="footnotes">
<li id="footnote_0_773" class="footnote"><a href="http://en.wikipedia.org/wiki/Law_of_sines" onclick="__gaTracker('send', 'event', 'outbound-article', 'http://en.wikipedia.org/wiki/Law_of_sines', 'http://en.wikipedia.org/wiki/Law_of_sines');">http://en.wikipedia.org/wiki/Law_of_sines</a> [<a href="#identifier_0_773" class="footnote-link footnote-back-link">&#8617;</a>]</li>
</ol>
<div class='shareaholic-canvas' data-app-id='17416102' data-app='recommendations' data-title='Tracking algorithm: considering the inclination of the drone' data-link='https://www.ludep.com/tracking-algorithm-considering-the-inclination-of-the-drone/' data-summary=''></div>		</div>
		<div class="clear"></div>
		
	</div>
		<div id="post-703" class="post post-703 type-post status-publish format-standard has-post-thumbnail hentry category-drone category-ideas category-issues category-programming category-refining-the-project">
		<h2 class="h1"><a href="../../drone-new-pid-with-polar-coordinates-and-howto-improve-reactivity-and-accuracy/" rel="bookmark">Drone: new PID with polar coordinates and HowTo improve reactivity and accuracy</a></h2>

					<table class="info entry-meta">
				<tr>
					<td class="date">June 26, 2011</td>
					<td>
													<span class="postedby">
								Posted by <a href="http://michael/" title="Visit Michael&#8217;s website" rel="author external">Michael</a> 
							</span>
								<span class="filledunder">under</span>
												<span class="filledunder">
							<a href="" rel="category tag">Drone</a>, <a href="../ideas/" rel="category tag">Ideas</a>, <a href="../issues/" rel="category tag">Issues</a>, <a href="../programming/" rel="category tag">Programming</a>, <a href="../refining-the-project/" rel="category tag">Refining the project</a>						</span>
					</td>
											<td>
						
				
							<div class="act">
																	<span class="comments">Comments off</span>
																							</div>
						</td>
					
				</tr>
			</table>
				
									
		
		
		<div class="content">
			
			<div style="float:right;padding: 0 0 10px 10px" class="interactive_right"><iframe allowtransparency="true" frameborder="0" scrolling="no" src="http://platform.twitter.com/widgets/tweet_button.html?url=https%3A%2F%2Fwww.ludep.com%2Fdrone-new-pid-with-polar-coordinates-and-howto-improve-reactivity-and-accuracy%2F&amp;text=Drone:%20new%20PID%20with%20polar%20coordinates%20and%20HowTo%20improve%20reactivity%20and%20accuracy&amp;count=vertical&amp;lang=" style="width:65px; height:65px;"></iframe><iframe src="http://www.facebook.com/plugins/like.php?href=https%3A%2F%2Fwww.ludep.com%2Fdrone-new-pid-with-polar-coordinates-and-howto-improve-reactivity-and-accuracy%2F&amp;layout=box_count&amp;show_faces=false&amp;width=65&amp;action=like&amp;font=arial&amp;colorscheme=light&amp;height=65" scrolling="no" frameborder="0" style="border:none; overflow:hidden; width:65px; height:65px;" allowTransparency="true"></iframe></div><h2>Handling polar coordinates for the PID</h2>
<h3 style="text-align: justify;">Defining a new error</h3>
<p style="text-align: justify;">Previously<sup><a href="#footnote_0_703" id="identifier_0_703" class="footnote-link footnote-identifier-link" title="As stated in a former article : http://www.ludep.com/performing-simple-image-analysis-and-full-pid-controller-with-the-drone/">1</a></sup>, we have seen how to manage a fair tracking with a PID control loop that uses a traditional Cartesian coordinates system. Picturing its idea seemed however rather less intuitive than by considering polar coordinates.</p>
<p style="text-align: justify;">We are indeed considering a central point and an offset between it and the position of the roundel. The goal of the PID is to make them be about the same. Therefore, we can simply consider that the distance between the middle of our plan and the roundel is a radius, and an angle is formed by the abscissae axis and this radius (look at the figure below to picture the situation).</p>
<p style="text-align: justify;"><a href="../wp-content/uploads/2011/06/cartesianToPolar_graphic.png"><img class="aligncenter size-large wp-image-731" title="cartesianToPolar_graphic" src="../wp-content/uploads/2011/06/cartesianToPolar_graphic-1024x388.png" alt="" width="640" height="242" srcset="../wp-content/uploads/2011/06/cartesianToPolar_graphic-1024x388.png 1024w, ../wp-content/uploads/2011/06/cartesianToPolar_graphic-300x113.png 300w, ../wp-content/uploads/2011/06/cartesianToPolar_graphic-100x37.png 100w, ../wp-content/uploads/2011/06/cartesianToPolar_graphic.png 1107w" sizes="(max-width: 640px) 100vw, 640px" /></a></p>
<p style="text-align: justify;">With using the radius as the only error parameter, a PID controller can be implemented. In such a representation of the system, what does really matter is for the radius to be as close to zero as possible. Having a different angle does not make any difference in measuring the angle: it is as wrong to be at a 3Pi/4 angle as at a -Pi/2 angle (as long as the radius is the same in both cases). The correction applied to the motors will be the same in intensity, and power applied is what is really at stakes while dealing with this kind of system. The angle will serve the only purpose of telling to the motors in what direction they have to rotate in order to move the drone in the right direction &#8211; no PID is necessary for that. Our PID is rather here to tell how fast the drone has to move in that direction.</p>
<h3 style="text-align: justify;">Changing the code</h3>
<p style="text-align: justify;">It appears then more natural and even easier to handle one radius parameter instead of the old two x and y error parameters &#8211; one for each axis. This change required yet a few tweaks in the code that had to be tested independently:</p>
<ul style="text-align: justify;">
<li>image analysis returns Cartesian coordinates for roundel position. A switch from Cartesian coordinates to polar ones has to be done. The maths behind this change are straightforward:</li>
</ul>
<p style="text-align: justify;"><a href="../wp-content/uploads/2011/06/cartesianToPolar1.png"><img class="aligncenter size-full wp-image-722" title="cartesianToPolar" src="../wp-content/uploads/2011/06/cartesianToPolar1.png" alt="" width="655" height="153" srcset="../wp-content/uploads/2011/06/cartesianToPolar1.png 655w, ../wp-content/uploads/2011/06/cartesianToPolar1-300x70.png 300w, ../wp-content/uploads/2011/06/cartesianToPolar1-100x23.png 100w" sizes="(max-width: 655px) 100vw, 655px" /></a></p>
<ul style="text-align: justify;">
<li>before doing so, it might be nice to perform an axial symmetry using the x-axis, in order to get a more intuitive picture of the plan. Here is the call to the function changing the coordinates &#8211; the symmetry is done while passing parameters:</li>
</ul>
<pre style="padding-left: 60px;">convertToPolarCoordinates(xval - XMIDDLE, -(yval - YMIDDLE), &amp;radius, &amp;theta);

//XMIDDLE is the x-value for which the image is equally split in two parts (same goes with YMIDDLE and the y-axis)</pre>
<ul>
<li style="text-align: justify;">creating a new function for the drone is necessary: it has to be possible to tell it to go in a defined direction, at a given speed. Since the API can only handle orders on two Cartesian axis, to pitch and roll (not mentioning yaw to turn and gaz to change altitude), some basic conversion (converting a movement on one axis to a movement on two perpendicular axis)  has also to be taken care of here.</li>
</ul>
<p>&nbsp;</p>
<p style="text-align: center;"><a href="../wp-content/uploads/2011/06/setDirection3.png"><img class="aligncenter size-thumbnail wp-image-733" title="setDirection" src="../wp-content/uploads/2011/06/setDirection3.png" alt="" width="752" height="274" srcset="../wp-content/uploads/2011/06/setDirection3.png 1044w, ../wp-content/uploads/2011/06/setDirection3-300x109.png 300w, ../wp-content/uploads/2011/06/setDirection3-1024x372.png 1024w, ../wp-content/uploads/2011/06/setDirection3-100x36.png 100w" sizes="(max-width: 752px) 100vw, 752px" /></a></p>
<p style="text-align: justify;">The core of the algorithm kept unchanged: we merely apply a PID control loop that take the radius as an error parameter that should be close to zero. The results were therefore as good as the previous one (not better). A simpler Proportional Derivative (PD) is being considered, insofar as the Integral term main purpose is to help remove small errors to help being exactly on top of the target, which is not essential for us, as long as the drone does not describe huge circles around it. We will go back later on this precise matter.</p>
<h2 style="text-align: justify;">Responsiveness tests: which detection is really efficient ?</h2>
<h3 style="text-align: justify;">A need for faster loops</h3>
<p style="text-align: justify;">We recently introduced image analysis to deal with tag detection on the PC side. This was done with the idea of taking advantage of a greater computing power and the possibility to choose the kind of tag we want to track &#8211; hence getting ride of the limitation induced by the drone firmware. We have experimented that our detection roughly provided the same results, even better on average than the one given by the drone.</p>
<p style="text-align: justify;">Well, this conclusion proved to be partly right. We were indeed a little more efficient than the embedded program in terms of frames received and analyzed: for a new frame received by the computer, our OpenCV algorithm performs a little better than the one embedded on the drone<strong> for the same frame</strong>. Since the PC sends orders to the drone only when a new frame was received, no matter if we are considering the OpenCV analysis or the embedded one, the PID results were almost the same.</p>
<p style="text-align: justify;">The problem lies in the fact that the computer does not received all the frames got by the 60 fps vertical camera. Whereas this is due to a loss of data happening during the WiFi communication, a problem of bandwidth, or a slow processing time of new frames on the drone or computer side, we don&#8217;t really know. Since we have no access to the drone&#8217;s firmware yet, we cannot do anything about it. Anyway, our loop were therefore quite slow, running at an average speed of 62ms, meaning less than 10 frames per second (without image analysis, which would decrease again this speed). So as much new orders per second sent to the drone. And this is without taking into account some big slowdown on the computer side, entailing in delays of sometimes more than a second. Which is huge while considering such a reactive system: if the power applied to the motors at a given time is someway high due to a PID correction, a delay even as small as 3/4 of a second can have the drone overshoot its target so it will lose it for good.</p>
<h3 style="text-align: justify;">Experiments</h3>
<p style="text-align: justify;">To see how much useful data were lost and hence unanalysable by our algorithm, we kept running our OpenCV image analysis and the embedded roundel recognition at the same time, comparing the number of matches. However, the waiting time we used to have in each loop was deleted, so the program could run a new iteration even if the frame received was still the same. Because not getting any new frame does not mean not getting new navigation data, the program had then access to those navigation data send by the drone faster. And among those navigation data are kept the coordinates of tags detected by the algorithm embedded on the drone.</p>
<p style="text-align: justify;">The next figure pictures the experiment process in a chart. Note: the results would have been even more obvious if we  were to split the OpenCV analysis and the navdata handling in two different threads.</p>
<p style="text-align: center;"><a href="../wp-content/uploads/2011/06/efficiencyLogging.png"><img class="aligncenter size-full wp-image-749" title="efficiencyLogging" src="../wp-content/uploads/2011/06/efficiencyLogging.png" alt="" width="478" height="586" srcset="../wp-content/uploads/2011/06/efficiencyLogging.png 683w, ../wp-content/uploads/2011/06/efficiencyLogging-244x300.png 244w, ../wp-content/uploads/2011/06/efficiencyLogging-81x100.png 81w" sizes="(max-width: 478px) 100vw, 478px" /></a></p>
<p style="text-align: justify;">The results are listed in the graph below. On average, the<strong> embedded algorithm records 1.45 times more <em>different </em>coordinates</strong> of the ground tag than the OpenCV algorithm running on the computer.</p>
<p style="text-align: justify;"><a href="../wp-content/uploads/2011/06/efficiencyLogging_graph.png"><img class="aligncenter size-large wp-image-751" title="efficiencyLogging_graph" src="../wp-content/uploads/2011/06/efficiencyLogging_graph-1024x601.png" alt="" width="640" height="375" srcset="../wp-content/uploads/2011/06/efficiencyLogging_graph-1024x601.png 1024w, ../wp-content/uploads/2011/06/efficiencyLogging_graph-300x176.png 300w, ../wp-content/uploads/2011/06/efficiencyLogging_graph-100x58.png 100w, ../wp-content/uploads/2011/06/efficiencyLogging_graph.png 1091w" sizes="(max-width: 640px) 100vw, 640px" /></a></p>
<p style="text-align: justify;">Our recent discoveries with the speed acquisition of navigation made us test it without any video display on our computer, not to mention video analysis. Our running loop went therefore faster, multiplying its speed by about 300 times. Even if it does not multiply the navigation data like this, we still receive some more, and are sure to get all of them, without losing them while the image analysis is being processed.</p>
<h3 style="text-align: justify;">Conclusion</h3>
<h4 style="text-align: justify;">Gained responsiveness</h4>
<p style="text-align: justify;">The main comment that can be done about those results is that the embedded detection is obviously much more efficient (about 45% more)  once we consider all the useful frames. And the reason for that is that the drone has more frame at its disposal on which it can run the analysis than the WiFi connected computer. The actual drone&#8217;s navigation data keep changing even while no new frame is received, which confirms that some frames are lost in the process (otherwise coordinates sent by the drone would come at the same pace than those got by our OpenCV algorithm). Add this to the fact that the image is converted from raw data to an actual image that can be displayed on the computer&#8217;s screen during the transmission process, and you can start having a better idea of the benefits in dealing with algorithms on board rather than with a second device, no matter how powerful it is.</p>
<p style="text-align: justify;">One path we could follow in order to get improved results without changing our way of doing things lies in using the newly release ARDrone&#8217;s firmware, that allegedly improves the video decoding time process thanks to an other codec. The problem is that this firmware does not seem stable enough at the moment, and it really messes things up with our code.</p>
<p style="text-align: justify;">We could however implement the image analysis in a separate thread, without slowing down the PID algorithm. Since we will gain speed in receiving navigation data as we saw it, we might want to not check twice the same package (i.e. filtering data), and therefore send only once the same order to the drone, so as to avoid jamming the bandwidth.</p>
<h4 style="text-align: justify;">What to do with those performance conclusions ?</h4>
<p style="text-align: justify;">One legitimate question one may ask is whether we really need all those frames for fulfilling our tracking purpose. Our early tests showed us a much more responsive and accurate drone, that kept its target in sight longer. The PID (or PD at least) needs to be tuned again, since the drone has still a tendency to wander around the roundel, and not hover perfectly on top of it.</p>
<p style="text-align: justify;">As for our flock of robot tracking purpose, we may have now a major issue. We will need to do image analysis to detect different robots while following them at the same time. But since we actually need to be quickly responsive for the task that helps follow the leader, we can contemplate doing the following:</p>
<ul style="text-align: justify;">
<li>use the really efficient embedded detection for hovering on top of the leader.</li>
<li>take advantage of our own OpenCV image analysis in a separate, slower thread, for reporting coordinates and orientation of the other robots in the flock. We do not need a speed as high as for the hovering task to do so, so it should be just fine for keeping the formation on the ground.</li>
<li>since we plan one being able to change our leader at any time, and tags recognized by the drone are limited, we will have to use whatever is made available by the engineers at Parrot. For the moment, roundels, oriented roundels and stripes of different colors can be tracked. This should be just enough for our task.</li>
</ul>
<p style="text-align: justify;">This can all be summed up in the chart below.</p>
<p style="text-align: justify;"><a href="../wp-content/uploads/2011/06/PCThreads.png"><img class="aligncenter size-large wp-image-747" title="PCThreads" src="../wp-content/uploads/2011/06/PCThreads-1024x601.png" alt="" width="640" height="375" srcset="../wp-content/uploads/2011/06/PCThreads-1024x601.png 1024w, ../wp-content/uploads/2011/06/PCThreads-300x176.png 300w, ../wp-content/uploads/2011/06/PCThreads-100x58.png 100w, ../wp-content/uploads/2011/06/PCThreads.png 1051w" sizes="(max-width: 640px) 100vw, 640px" /></a></p>
<p>&nbsp;<br />
<b>References</b></p>
<ol class="footnotes">
<li id="footnote_0_703" class="footnote">As stated in a former article : <a href="../../performing-simple-image-analysis-and-full-pid-controller-with-the-drone/">http://www.ludep.com/performing-simple-image-analysis-and-full-pid-controller-with-the-drone/</a> [<a href="#identifier_0_703" class="footnote-link footnote-back-link">&#8617;</a>]</li>
</ol>
<div class='shareaholic-canvas' data-app-id='17416102' data-app='recommendations' data-title='Drone: new PID with polar coordinates and HowTo improve reactivity and accuracy' data-link='https://www.ludep.com/drone-new-pid-with-polar-coordinates-and-howto-improve-reactivity-and-accuracy/' data-summary=''></div>		</div>
		<div class="clear"></div>
		
	</div>
		<div id="post-586" class="post post-586 type-post status-publish format-standard has-post-thumbnail hentry category-drone category-issues category-programming category-testing">
		<h2 class="h1"><a href="../../performing-simple-image-analysis-and-full-pid-controller-with-the-drone/" rel="bookmark">Performing simple image analysis and full PID controller with the Drone</a></h2>

					<table class="info entry-meta">
				<tr>
					<td class="date">June 10, 2011</td>
					<td>
													<span class="postedby">
								Posted by <a href="http://michael/" title="Visit Michael&#8217;s website" rel="author external">Michael</a> 
							</span>
								<span class="filledunder">under</span>
												<span class="filledunder">
							<a href="" rel="category tag">Drone</a>, <a href="../issues/" rel="category tag">Issues</a>, <a href="../programming/" rel="category tag">Programming</a>, <a href="../testing/" rel="category tag">Testing</a>						</span>
					</td>
											<td>
						
				
							<div class="act">
																	<span class="comments">Comments off</span>
																							</div>
						</td>
					
				</tr>
			</table>
				
									
		
		
		<div class="content">
			
			<div style="float:right;padding: 0 0 10px 10px" class="interactive_right"><iframe allowtransparency="true" frameborder="0" scrolling="no" src="http://platform.twitter.com/widgets/tweet_button.html?url=https%3A%2F%2Fwww.ludep.com%2Fperforming-simple-image-analysis-and-full-pid-controller-with-the-drone%2F&amp;text=Performing%20simple%20image%20analysis%20and%20full%20PID%20controller%20with%20the%20Drone&amp;count=vertical&amp;lang=" style="width:65px; height:65px;"></iframe><iframe src="http://www.facebook.com/plugins/like.php?href=https%3A%2F%2Fwww.ludep.com%2Fperforming-simple-image-analysis-and-full-pid-controller-with-the-drone%2F&amp;layout=box_count&amp;show_faces=false&amp;width=65&amp;action=like&amp;font=arial&amp;colorscheme=light&amp;height=65" scrolling="no" frameborder="0" style="border:none; overflow:hidden; width:65px; height:65px;" allowTransparency="true"></iframe></div><p style="text-align: justify;">So far, we have been able to detect roundels on the floor with the drone by using an already existing embedded function. We have even managed to conceive a basic proportional controller (P) on the drone to track the detected roundel. Now, we have added more flexibility by using our own detection algorithm to track our own patterns freely, on top of having greatly improved our tracking control loop with a full Proportional, Derivative, Integrative (PID) control. Altitude is also managed by a simpler PI control.</p>
<h2 style="text-align: justify;">Detecting circles with OpenCV</h2>
<h3 style="text-align: justify;">Why image analysis ?</h3>
<p style="text-align: justify;">The algorithm for roundel detection developed by the engineers at Parrot was working well for achieving its immediate purpose, but this was not satisfying for us in many ways:</p>
<ul>
<li style="text-align: justify;">We have no control over its implementation. Since it is embedded on the drone firmware and we don&#8217;t have access to it, we are not able to change even a small part of it. Moreover, this function may disappear at any time in later firmware updates.</li>
<li style="text-align: justify;">We cannot decide the shape it recognizes. This is especially annoying for us, since we would like to detect different robots and identify them as such, preferably with an orientation (the pre-existing function can detect the direction of a stripped roundel, but not its orientation).</li>
<li style="text-align: justify;">Doing the image analysis on a separate computer provides us with more computing power than what is possible with the drone alone. Thus we may theoretically achieve a more efficient pattern recognition. We stay however careful about this assumption, since the delay induced by the WiFi communication and the other navigation data transfer may counterbalance this positive effect. Plus, we are beginners with OpenCV image analysis in real-time.</li>
</ul>
<h3 style="text-align: justify;">Starting with OpenCV</h3>
<p style="text-align: justify;">OpenCV seemed to be the natural way of doing our own video analysis: it is open source, greatly supported by developers and big companies such as Intel, the library has more than 500 optimized algorithms that do not need to be reinvented, it has been primarily developed for a C++ use, and so on.</p>
<p style="text-align: justify;">To first get accustomed with OpenCV and video analysis, we decided to replicate what the algorithm we have used until now is able to do. And for that matter, since we work for the moment in an environment we know, that the drone and robots are probing, we kept things simple by just <strong>detecting circles on the video stream</strong>. Our floor is indeed perfectly flat and made of only one color, without any pattern. An efficient algorithm to perform that is explained by Robert Laganière in one of his books<sup><a href="#footnote_0_586" id="identifier_0_586" class="footnote-link footnote-identifier-link" title="OpenCV 2 Computer Vision Application Programming Cookbook (Paperback) by Robert Laganiere, Packt Publishing Limited - ISBN 13: 9781849513241 ISBN 10: 1849513244">1</a></sup>.</p>
<p style="text-align: justify;">Basically, for each new frame send by the drone to the computer, we apply a Gaussian blur filter to smooth the image and avoid detecting false circles because of the noise. We then use a Canny detection<sup><a href="#footnote_1_586" id="identifier_1_586" class="footnote-link footnote-identifier-link" title="Edge detection algorithm by John F. Canny, explained on Wikipedia: http://en.wikipedia.org/wiki/Canny_edge_detector">2</a></sup> and a Hough transform<sup><a href="#footnote_2_586" id="identifier_2_586" class="footnote-link footnote-identifier-link" title="Feature extraction technique, explained on Wikipedia: http://en.wikipedia.org/wiki/Hough_transform">3</a></sup> that are regrouped in one function call, that need to have a one channel image as an input. That is why we need to first convert the color frame into an image represented by shades of gray:</p>
<pre>cv::GaussianBlur(bottomMat, bottomMat, cv::Size(5,5),1.5); <span style="color: #3366ff;">//bottomMat is the matrix of the frame we analyse</span>
cv::cvtColor(bottomMat, bottomMatDraw, CV_BGR2GRAY); <span style="color: #3366ff;">// convert 3-channel image to 1-channel gray image</span>
cv::equalizeHist(bottomMatDraw, bottomMatDraw); <span style="color: #3366ff;">// Equalize the histogram on this matrix to improve contrast; </span>
<span style="color: #3366ff;">//may not be necessary, depending on lighting conditions</span>
cv::HoughCircles(bottomMatDraw,         <span style="color: #3366ff;">// Frame to be analysed</span>
            	circles, 		<span style="color: #3366ff;">// Vector returned containing detected circles parameters</span>
            	CV_HOUGH_GRADIENT,      <span style="color: #3366ff;">// Two-pass circle detection method</span>
            	2, 			<span style="color: #3366ff;">// Accumulator resolution (image size / 2)</span>
            	50, 			<span style="color: #3366ff;">// Min. distance between two circles</span>
            	200, 			<span style="color: #3366ff;">// Canny high threshold (low thresh. = high / 2)</span>
            	75, 			<span style="color: #3366ff;">// Minimum number of votes to pass to consider a new candidate as valid</span>
            	5, 75); 		<span style="color: #3366ff;">// Min and max radius for circles to detect</span></pre>
<p>&nbsp;</p>
<h3>Results</h3>
<table class="aligncenter" width="800" align="center">
<tbody>
<tr>
<td valign="center"><a href="../wp-content/uploads/2011/06/roundelTracking2.png"><img class="size-medium wp-image-587" title="roundelTracking" src="../wp-content/uploads/2011/06/roundelTracking2.png" alt="" width="400" height="248" align="center" srcset="../wp-content/uploads/2011/06/roundelTracking2.png 980w, ../wp-content/uploads/2011/06/roundelTracking2-300x186.png 300w, ../wp-content/uploads/2011/06/roundelTracking2-100x62.png 100w" sizes="(max-width: 400px) 100vw, 400px" /></a></td>
<td><object width="425" height="349" classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" codebase="http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=6,0,40,0"><param name="allowFullScreen" value="true" /><param name="allowscriptaccess" value="always" /><param name="src" value="http://www.youtube.com/v/EeXDYHnXCbA?version=3&amp;hl=en_US" /><param name="allowfullscreen" value="true" /><embed width="425" height="349" type="application/x-shockwave-flash" src="http://www.youtube.com/v/EeXDYHnXCbA?version=3&amp;hl=en_US" allowFullScreen="true" allowscriptaccess="always" allowfullscreen="true" /></object></td>
</tr>
<tr>
<th>Example of the roundel detection performed with a streaming video. Bottom left: Circles are drawn on top of the actual roundels. Top left: position of the roundel as detected by the Parrot embedded algorithm. Top right: front view of the drone, overlapped by the bottom view (disabled here).</th>
<th>Video showing how the recognition performs in real-time. The drone is voluntarily shaken to test the efficiency and the speed of the image analysis, that is actually fast and accurate enough, despite varying heights and non-steady rolling from side to side.</th>
</tr>
</tbody>
</table>
<p>&nbsp;</p>
<p style="text-align: justify;">The algorithm proved to be eventually efficient: on average, we detect even more circles than with the embedded algorithm. The good refreshing frequency of the vertical camera is really helpful for such detection (60 frames per second) &#8211; even if we don&#8217;t get all of the frames over the WiFi connection. Yet, its biggest drawback lays in its poor resolution: we have to deal with a CMOS sensor that has a QCIF <strong>resolution of 176*144 pixels</strong>. Our recent experiments show that this is going to be a major issue while dealing with more than one robot on the ground.</p>
<p style="text-align: justify;">And we have another practical concern: it is well possible to detect our robot and keep track of it at a height of around 180 cm &#8211; but we may certainly need more than that for many robots at the same time. Our ceiling (less than 3 meters high) will be an inconvenient limitation regarding this issue.</p>
<p style="text-align: justify;">A next step will be to detect different kinds of <strong>oriented </strong>patterns at the same time. That will involve more elaborated algorithms and will require more computing resources.</p>
<h2>PID control loop</h2>
<p style="text-align: justify;">Since we now have a fairly reliable detection that reports the coordinates of a roundel (therefore a robot), we can bother with implementing a proper tracking algorithm. A feedback look using a PID seems appropriate for such a device. It is the controller used by the engineers at Parrot for managing many aspects of the drone, and it is the only kind that we really know; besides, it appears to be not to complex, and can achieve really good performances.</p>
<h3 style="text-align: justify;">How to give the quadricopter orders</h3>
<p style="text-align: justify;">The drone is controlled thanks to high-level commands that will rotate the rotors accordingly, and this is mainly done by changing four parameters:</p>
<ul style="text-align: justify;">
<li>pitch: to go forward (negative values) or backward (positive values)</li>
<li>roll: to go right (positive values) or left (negative values)</li>
<li>gaz: to go up (negative values) and down (positive values)</li>
<li>yaw: to turn right (positive values) and left (negative values)</li>
</ul>
<p style="text-align: justify;">Those values range from -25000 to +25000: the greatest they are modulus-wise, the fastest the movement will be. To track an object on the ground, the drone can stay at the same altitude (that is performed by a simple proportional and derivative controller) and does not need to turn on itself, since it can move in any direction on the same 2D plane only with pitching and rolling (yawing is mainly a good way to point the horizontal camera in a specific direction). We therefore need to concentrate solely on the <strong>pitch </strong>and <strong>roll </strong>parameters.</p>
<h3 style="text-align: justify;">Defining the PID error</h3>
<p style="text-align: justify;">While using a PID controller, one has to define what the error is. For that, we first want to describe what is the goal of our system. We want our drone to hover on top of our roundel that is detected by the vertical camera. We can therefore simplify the problem by looking at the rectangle formed by the field of view of the camera, and saying that we want our roundel located in its very center at any time. The roundel is represented by a circle thanks to our image analysis, for which we really just need the center. Basically, our problem consists in having one given point of known coordinates centered in the middle of one rectangle.</p>
<p style="text-align: justify;">The error can then be measured by looking -at the same time- at the differences between:</p>
<ul style="text-align: justify;">
<li>the <strong>x-axis</strong> coordinate of the roundel point and the x-axis coordinate of the center of the image. This is going to influence on the <strong>roll value</strong>.</li>
<li>the <strong>y-axis</strong> coordinate of the roundel point and the y-axis coordinate of the center of the image. This is going to influence on the <strong>pitch </strong>value.</li>
</ul>
<table class="aligncenter" width="500" align="center">
<tbody>
<tr>
<td><a href="../wp-content/uploads/2011/06/PID_tracking_schematic.png"><img class="aligncenter size-medium wp-image-618" title="PID_tracking_schematic" src="../wp-content/uploads/2011/06/PID_tracking_schematic.png" alt="" width="500" height="407" srcset="../wp-content/uploads/2011/06/PID_tracking_schematic.png 807w, ../wp-content/uploads/2011/06/PID_tracking_schematic-300x244.png 300w, ../wp-content/uploads/2011/06/PID_tracking_schematic-100x81.png 100w" sizes="(max-width: 500px) 100vw, 500px" /></a></td>
</tr>
<tr>
<th>This is how is calculated the error for the PID controller. We compute an error on each axis, apply the PID algorithm on both of them separately, and give the orders to activate the pitch and roll movement accordingly. Hence a unique movement that is the result of the composition of two different actions. Note that the arrows do mean that <strong>the roundel moves relatively to the camera</strong>;<strong> in fact</strong>, the result of the PID control is that <strong>the camera moves towards the roundel</strong>.</th>
</tr>
</tbody>
</table>
<p style="text-align: justify;">This boils down to having two PID controllers that yet keep the same gains parameters, since nothing is different in both cases except the orientation (same motors, same sensor, symmetric goal). Each of them has however its own error tracking and proportional, integral and derivative values evolving through time. Once this has been established, the PID implementation is straightforward, as described by J. Sluka<sup><a href="#footnote_3_586" id="identifier_3_586" class="footnote-link footnote-identifier-link" title="A PID Controller For Lego Mindstorms Robots, by J. Sluka: http://www.inpharmix.com/jps/PID_Controller_For_Lego_Mindstorms_Robots.html">4</a></sup>, who provides a very good description of its purpose, its tuning and an easy to understand pseudo-code. We do not write our code right here, since there are plenty of examples of what we did on the web, and the nearest one can be found on Sluka&#8217;s webpage.</p>
<h3 style="text-align: justify;">Tuning the PID and first tests</h3>
<p style="text-align: justify;">The hardest part in implementing a PID feedback loop is to correctly tune the three gain parameters: Kp, Ki and Kd. They greatly depend on the device used, and may even change between two robots with the same characteristics. A not too hard method to find a fair approximation of those gains values is the Ziegler-Nichols heuristic method<sup><a href="#footnote_4_586" id="identifier_4_586" class="footnote-link footnote-identifier-link" title="Ziegler-Nichols heuristic method, explained on Wikipedia: http://en.wikipedia.org/wiki/Ziegler%E2%80%93Nichols_method">5</a></sup>. But even after that, some more tuning is still needed, and we don&#8217;t have the hardware or software that could help us in that matter.</p>
<table class="aligncenter" width="600">
<tbody>
<tr>
<td><a href="../wp-content/uploads/2011/06/PID_variables_graph.png"><img class="aligncenter size-medium wp-image-626" title="PID_variables_graph" src="../wp-content/uploads/2011/06/PID_variables_graph.png" alt="" width="600" height="274" srcset="../wp-content/uploads/2011/06/PID_variables_graph.png 1366w, ../wp-content/uploads/2011/06/PID_variables_graph-300x137.png 300w, ../wp-content/uploads/2011/06/PID_variables_graph-1024x467.png 1024w, ../wp-content/uploads/2011/06/PID_variables_graph-100x45.png 100w" sizes="(max-width: 600px) 100vw, 600px" /></a></td>
</tr>
<tr>
<th>In order to ease the tuning, we kept track of all variables during the running time. Here, gain parameters are still not perfect, yet they are good enough to have a estimation of the oscillation period Pc on both<strong> x and y axis</strong> <em>(movements represented in blue and red)</em>, which has to be measured to use the Ziegler-Nichols method. Reducing the oscillation is usually made by increasing the proportional term Kp. Note also that the PI control for the altitude <em>(in green)</em> already does a good job.</th>
</tr>
</tbody>
</table>
<p style="text-align: justify;">To tune it faster, we made it possible to change each gain parameter in real-time with the XBox controller. The results are pretty convincing so far, and we were able to follow our omniwheel robot in our office over 4 meters (we lack the necessary space to test it quickly on greater distances). However, it has to be known that some conditions need to be respected in order to have a good result, for the moment at least:</p>
<ul>
<li style="text-align: justify;">no obstacles should be present around the field where both devices are moving. If a sharp difference in height is detected on the ground, the PI controller for the altitude will react quickly and the drone will suddenly go up or done to correct its altitude. This is efficient in a way, since it is working well and as expected, but is remains a problem in an enclosed room like ours, since the UAV can be stuck to the ceiling, and then lose its target.</li>
<li style="text-align: justify;">the robot shall not move too fast, otherwise the drone will lose its sight.</li>
<li style="text-align: justify;">the environment has to be correctly lighted, otherwise the image analysis may prove fail from time to time. We do not need a bright light or even a uniform light over all the surroundings, but we do at least need some light to be shed from the ceiling for instance (or the sun in an outside setting).</li>
<li style="text-align: justify;">the floor shall not be made of any pattern -at least, no circular one-, because of our own specific image analysis. This shall be addressed later.</li>
</ul>
<table class="aligncenter" width="425" align="center">
<tbody>
<tr>
<td><object width="425" height="349" classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" codebase="http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=6,0,40,0"><param name="allowFullScreen" value="true" /><param name="allowscriptaccess" value="always" /><param name="src" value="http://www.youtube.com/v/q2vN9DEwf6k?version=3&amp;hl=en_US" /><param name="allowfullscreen" value="true" /><embed width="425" height="349" type="application/x-shockwave-flash" src="http://www.youtube.com/v/q2vN9DEwf6k?version=3&amp;hl=en_US" allowFullScreen="true" allowscriptaccess="always" allowfullscreen="true" /></object></td>
</tr>
<tr>
<th>Our actual progress in action. This time, everything is performed by our own algorithms, for both the drone and the omniwheel. For the record, here the gains are : Kp = 21, Ki = 1, Kd = 83. Oh, by the way, nobody was hurt in the making of this video: at the end, you can actually see me taking control of the drone just before fulfilling a safe landing.</th>
</tr>
</tbody>
</table>
<p style="text-align: justify;">
<h3 style="text-align: justify;">Going on&#8230;</h3>
<p style="text-align: justify;">Our next short-term goals are therefore to tune better the PID gains (Kp, Ki and Kd) in order to assure more stability while hovering over the roundel. Furthermore, we are willing to switch to a polar coordinate representation of what is seen by the drone, that should add clarity and consistency to our PID algorithm.</p>
<p>&nbsp;<br />
<b>References</b></p>
<ol class="footnotes">
<li id="footnote_0_586" class="footnote"><em>OpenCV 2 Computer Vision Application Programming Cookbook</em> (Paperback) by Robert Laganiere, Packt Publishing Limited &#8211;<strong> ISBN 13</strong>: 9781849513241 <strong>ISBN 10</strong>: 1849513244 [<a href="#identifier_0_586" class="footnote-link footnote-back-link">&#8617;</a>]</li>
<li id="footnote_1_586" class="footnote">Edge detection algorithm by John F. Canny, explained on Wikipedia: <a href="http://en.wikipedia.org/wiki/Canny_edge_detector" onclick="__gaTracker('send', 'event', 'outbound-article', 'http://en.wikipedia.org/wiki/Canny_edge_detector', 'http://en.wikipedia.org/wiki/Canny_edge_detector');">http://en.wikipedia.org/wiki/Canny_edge_detector</a> [<a href="#identifier_1_586" class="footnote-link footnote-back-link">&#8617;</a>]</li>
<li id="footnote_2_586" class="footnote">Feature extraction technique, explained on Wikipedia: <a href="http://en.wikipedia.org/wiki/Hough_transform" onclick="__gaTracker('send', 'event', 'outbound-article', 'http://en.wikipedia.org/wiki/Hough_transform', 'http://en.wikipedia.org/wiki/Hough_transform');">http://en.wikipedia.org/wiki/Hough_transform</a> [<a href="#identifier_2_586" class="footnote-link footnote-back-link">&#8617;</a>]</li>
<li id="footnote_3_586" class="footnote">A PID Controller For Lego Mindstorms Robots, by J. Sluka: <a href="http://www.inpharmix.com/jps/PID_Controller_For_Lego_Mindstorms_Robots.html" onclick="__gaTracker('send', 'event', 'outbound-article', 'http://www.inpharmix.com/jps/PID_Controller_For_Lego_Mindstorms_Robots.html', 'http://www.inpharmix.com/jps/PID_Controller_For_Lego_Mindstorms_Robots.html');">http://www.inpharmix.com/jps/PID_Controller_For_Lego_Mindstorms_Robots.html</a> [<a href="#identifier_3_586" class="footnote-link footnote-back-link">&#8617;</a>]</li>
<li id="footnote_4_586" class="footnote">Ziegler-Nichols heuristic method, explained on Wikipedia: http://en.wikipedia.org/wiki/Ziegler%E2%80%93Nichols_method [<a href="#identifier_4_586" class="footnote-link footnote-back-link">&#8617;</a>]</li>
</ol>
<div class='shareaholic-canvas' data-app-id='17416102' data-app='recommendations' data-title='Performing simple image analysis and full PID controller with the Drone' data-link='https://www.ludep.com/performing-simple-image-analysis-and-full-pid-controller-with-the-drone/' data-summary=''></div>		</div>
		<div class="clear"></div>
		
	</div>
		<div id="post-547" class="post post-547 type-post status-publish format-standard has-post-thumbnail hentry category-drone category-issues category-programming category-testing">
		<h2 class="h1"><a href="../../coding-with-the-drone-performing-roundel-tracking/" rel="bookmark">Coding with the drone &#8211; Performing roundel tracking</a></h2>

					<table class="info entry-meta">
				<tr>
					<td class="date">May 17, 2011</td>
					<td>
													<span class="postedby">
								Posted by <a href="http://michael/" title="Visit Michael&#8217;s website" rel="author external">Michael</a> 
							</span>
								<span class="filledunder">under</span>
												<span class="filledunder">
							<a href="" rel="category tag">Drone</a>, <a href="../issues/" rel="category tag">Issues</a>, <a href="../programming/" rel="category tag">Programming</a>, <a href="../testing/" rel="category tag">Testing</a>						</span>
					</td>
											<td>
						
				
							<div class="act">
																	<span class="comments">Comments off</span>
																							</div>
						</td>
					
				</tr>
			</table>
				
									
		
		
		<div class="content">
			
			<div style="float:right;padding: 0 0 10px 10px" class="interactive_right"><iframe allowtransparency="true" frameborder="0" scrolling="no" src="http://platform.twitter.com/widgets/tweet_button.html?url=https%3A%2F%2Fwww.ludep.com%2Fcoding-with-the-drone-performing-roundel-tracking%2F&amp;text=Coding%20with%20the%20drone%20%e2%80%93%20Performing%20roundel%20tracking&amp;count=vertical&amp;lang=" style="width:65px; height:65px;"></iframe><iframe src="http://www.facebook.com/plugins/like.php?href=https%3A%2F%2Fwww.ludep.com%2Fcoding-with-the-drone-performing-roundel-tracking%2F&amp;layout=box_count&amp;show_faces=false&amp;width=65&amp;action=like&amp;font=arial&amp;colorscheme=light&amp;height=65" scrolling="no" frameborder="0" style="border:none; overflow:hidden; width:65px; height:65px;" allowTransparency="true"></iframe></div><h2 style="text-align: justify;">Developing settings</h2>
<p style="text-align: justify;">Our developing environment for the drone is now properly settled, meaning that we can finally now be efficient while programming by writing a few lines of codes and testing it on the drone seconds later. It wasn&#8217;t an easy task, between the drone motherboard that suddenly ceased to work properly (thanks to the warranty and the good customer service of Parrot, this issue was solved ten days later, by receiving a brand new motherboard), the wifi connection that behaved randomly since the last Ubuntu update and an existing API code that is sometimes hard to follow.</p>
<p style="text-align: justify;">Basically, we are now in the following configuration -as long as the drone is concerned:</p>
<ul style="text-align: justify;">
<li>Ubuntu 11.04 (natty) with GNOME on the computer side (Intel Core 2 Duo @2.20GHz)</li>
<li>Firmware 1.5.1 on the drone</li>
<li>ARDrone API 1.6</li>
<li>XBox 360 controller for manual inputs (keyboard mapping currently broken)</li>
<li>jEdit as a code editor</li>
</ul>
<p style="text-align: justify;">Software-wise, nothing else is needed. Obviously, some librairies are required, such as SDL, g++ for the compiler, and later OpenCV for the image analysis. All the code will be indeed done in C and C++; most of what already exists is written in C (i.e. the API), and our personnal code shall mostly be written in C++.</p>
<h2 style="text-align: justify;">Activating our own algorithm</h2>
<p style="text-align: justify;">We now have the possibility to switch between a manual control for the drone (e.g. just after taking off and before landing) and a automated control managed by our own custom algorithm, by merely pushing one button on our controller. Besides, all other necessary commands are also here, coded by ourselves, like performing an emergency shutdown or a flat trim (calibration on the ground). A lot of this was achieved thanks to a helpful presentation found on the web<sup><a href="#footnote_0_547" id="identifier_0_547" class="footnote-link footnote-identifier-link" title="OpenCV/ARDrone Two Parts Presentation - PDF file, by Cooper Bills">1</a></sup>, on top of excerpts of code<sup><a href="#footnote_1_547" id="identifier_1_547" class="footnote-link footnote-identifier-link" title="Robot learning, page by Cooper Bills - see at the bottom of the page, in optional TA lectures">2</a></sup>.</p>
<p style="text-align: justify;">Some early tests were about having the drone describing a square pattern on a horizontal plane, or circles of ever increasing radius. Everything responds well &#8211; the biggest task remaining to avoid drone collisions with its surroundings was to understand how to handle properly the power of the motors, whose ranges go from -25000 to 25000 (what&#8217;s the difference in numbers between fast and really fast for instance ?). It has to be stated that the whole custom algorithm is running in real time on the computer, that constantly exchange data and commands with the drone.</p>
<h2 style="text-align: justify;">Tracking a roundel</h2>
<p style="text-align: justify;">One of the other objective we had in mind while taking the time to set a neat developing environment was to be able to soon integrate our own image analysis. This will be done in a specific part of our code using the library OpenCV.</p>
<p style="text-align: justify;">But before moving on to this next step that has still to be mastered, we wanted to use the already existing roundel detection enabled by the latest ARDrone firmware. Thanks to the API, we can get the coordinates of one (or many) roundels detected on the ground, by using the vertical camera. With these information, we quickly developed a really basic algorithm supposed to keep track of a roundel by hovering on top of it and hopefully following it. The drone basically uses a kind of a proportional controler: the furthest it is from its goal (that is, having the roundel located in a square centered in its vertical camera video field), the fastest it will activate its rotors to correct the error. Our first rough results with this approach can be seen in the video below.</p>
<p style="text-align: justify;">&nbsp;</p>
<p style="text-align: justify;">NB: the XBox controller only purpose is to assure that the drone is located on top of a roundel before activating our algorithm with a button.</p>
<table width="850" align="center">
<tbody>
<tr>
<td><object width="425" height="349"><param name="movie" value="http://www.youtube.com/v/Ord_gcHCtWs?fs=1&amp;hl=en_US" /><param name="allowFullScreen" value="true" /><param name="allowscriptaccess" value="always" /><embed type="application/x-shockwave-flash" width="425" height="349" src="http://www.youtube.com/v/Ord_gcHCtWs?fs=1&amp;hl=en_US" allowscriptaccess="always" allowfullscreen="true"></embed></object></td>
<td><object width="425" height="349"><param name="movie" value="http://www.youtube.com/v/CJ44WQrm8xA?fs=1&amp;hl=en_US" /><param name="allowFullScreen" value="true" /><param name="allowscriptaccess" value="always" /><embed type="application/x-shockwave-flash" width="425" height="349" src="http://www.youtube.com/v/CJ44WQrm8xA?fs=1&amp;hl=en_US" allowscriptaccess="always" allowfullscreen="true"></embed></object></td>
</tr>
</tbody>
</table>
<p style="text-align: justify;">&nbsp;</p>
<p style="text-align: justify;">Some obvious issues appear after our first tests :</p>
<ul style="text-align: justify;">
<li>The drone is not stable enough, it oscillates a lot, which may be enough for tracking one unique robot, but certainly a problem when more are involved</li>
<li>The drone overshoots regularly while trying to correct its error, risking losing track of the roundel</li>
<li>The altitude handling is also far from being smooth</li>
</ul>
<p style="text-align: justify;">All those remarks boil down to one: the controller is not satisfying enough, and more tuning with the constants won&#8217;t provide a dramatical improvement. This therefore leads to this conclusion: we need a better controller, and me may want to investigate a PID (Proportional, Derivative, Integrative) one. We have already done some promising tests with it so far, and it proves to be much more promising in terms of steadiness and robustness. It will however be the topic of a future article.</p>
<p>&nbsp;&nbsp;<br />
<b>References</b></p>
<ol class="footnotes">
<li id="footnote_0_547" class="footnote"><a href="http://www.cs.cornell.edu/Courses/cs4758/2011sp/materials/OpenCV_AR_Drone_Presentation.pdf" onclick="__gaTracker('send', 'event', 'outbound-article', 'http://www.cs.cornell.edu/Courses/cs4758/2011sp/materials/OpenCV_AR_Drone_Presentation.pdf', 'OpenCV/ARDrone Two Parts Presentation &#8211; PDF file');" target="_blank">OpenCV/ARDrone Two Parts Presentation &#8211; PDF file</a>, by Cooper Bills [<a href="#identifier_0_547" class="footnote-link footnote-back-link">&#8617;</a>]</li>
<li id="footnote_1_547" class="footnote"><a href="http://www.cs.cornell.edu/Courses/cs4758/2011sp/lectures.html" onclick="__gaTracker('send', 'event', 'outbound-article', 'http://www.cs.cornell.edu/Courses/cs4758/2011sp/lectures.html', 'Robot learning');" target="_blank">Robot learning</a>, page by Cooper Bills &#8211; see at the bottom of the page, in optional TA lectures [<a href="#identifier_1_547" class="footnote-link footnote-back-link">&#8617;</a>]</li>
</ol>
<div class='shareaholic-canvas' data-app-id='17416102' data-app='recommendations' data-title='Coding with the drone - Performing roundel tracking' data-link='https://www.ludep.com/coding-with-the-drone-performing-roundel-tracking/' data-summary=''></div>		</div>
		<div class="clear"></div>
		
	</div>
		<div id="post-495" class="post post-495 type-post status-publish format-standard has-post-thumbnail hentry category-drone category-issues category-programming">
		<h2 class="h1"><a href="../../controlling-the-drone-with-our-own-built-program-roundels-recognition/" rel="bookmark">Controlling the drone with our own built program &#8211; roundels recognition</a></h2>

					<table class="info entry-meta">
				<tr>
					<td class="date">April 18, 2011</td>
					<td>
													<span class="postedby">
								Posted by <a href="http://michael/" title="Visit Michael&#8217;s website" rel="author external">Michael</a> 
							</span>
								<span class="filledunder">under</span>
												<span class="filledunder">
							<a href="" rel="category tag">Drone</a>, <a href="../issues/" rel="category tag">Issues</a>, <a href="../programming/" rel="category tag">Programming</a>						</span>
					</td>
											<td>
						
				
							<div class="act">
																	<span class="comments">Comments off</span>
																							</div>
						</td>
					
				</tr>
			</table>
				
									
		
		
		<div class="content">
			
			<div style="float:right;padding: 0 0 10px 10px" class="interactive_right"><iframe allowtransparency="true" frameborder="0" scrolling="no" src="http://platform.twitter.com/widgets/tweet_button.html?url=https%3A%2F%2Fwww.ludep.com%2Fcontrolling-the-drone-with-our-own-built-program-roundels-recognition%2F&amp;text=Controlling%20the%20drone%20with%20our%20own%20built%20program%20%e2%80%93%20roundels%20recognition&amp;count=vertical&amp;lang=" style="width:65px; height:65px;"></iframe><iframe src="http://www.facebook.com/plugins/like.php?href=https%3A%2F%2Fwww.ludep.com%2Fcontrolling-the-drone-with-our-own-built-program-roundels-recognition%2F&amp;layout=box_count&amp;show_faces=false&amp;width=65&amp;action=like&amp;font=arial&amp;colorscheme=light&amp;height=65" scrolling="no" frameborder="0" style="border:none; overflow:hidden; width:65px; height:65px;" allowTransparency="true"></iframe></div><p style="text-align: justify;">So far, what has been shown here about the drone was mostly made possible thanks to third-party applications, that we managed in some way to have working with our devices (PC or smartphone). This was good as an introduction, but here you will read how we had it controlled thanks to programs we could compile by ourselves.</p>
<p style="text-align: justify;">First of all, we are using the AR.Drone SDK 1.6, with the last firmware to this day running on the drone, that is version 1.5.1. Lots of issues have been encountered with the latter by the developing community, among them:</p>
<ul style="text-align: justify;">
<li>Updating the firmware from version 1.3.3 directly to 1.5.1 while skipping 1.4 results in bricking the quadricopter. Parrot is currently working on a solution affordable to everybody<sup><a href="#footnote_0_495" id="identifier_0_495" class="footnote-link footnote-identifier-link" title="Have a look at the official and public forums to be kept up to date: http://forum.parrot.com/ardrone/en/viewforum.php?id=7">1</a></sup><sup><a href="#footnote_1_495" id="identifier_1_495" class="footnote-link footnote-identifier-link" title="http://www.ardrone-flyers.com/ is a great website to get answers on how to save your drone by yourself. Previous firmware versions can also be found in its wiki section.">2</a></sup>.</li>
<li>Using the Windows SDK 1.6 with the newest firmware implies losing the video stream, on top of many timeout issues and not working controls (well, not sure is this last one is directly linked to that combination).</li>
</ul>
<p style="text-align: justify;">So we tried the examples provided in the SDK, that enable basic control of the drone. However, before running them, one needs to compile and build the source code, making sure that all the libraries are correctly installed.</p>
<h2 style="text-align: justify;">Windows SDK example</h2>
<p style="text-align: justify;">To basically enjoy a good experiment with the Windows SDK 1.6, it is recommended to stay to a firmware version no more recent than the 1.4.7. This way, it is possible to display the camera feeds on the computer screen. The setup is completely tedious since nothing is working straight out of the zip archive. One would have to follow instructions made by other developers<sup><a href="#footnote_2_495" id="identifier_2_495" class="footnote-link footnote-identifier-link" title="Very clear instructions can be followed on this website to achieve that: http://www.sparticusthegrand.com/ardrone/ardrone-compile-windows-sdk-1-5-in-visual-studios-2010/ (it is about SDK 1.5, but still necessary for 1.6) ">3</a></sup>, on top of looking for help in the official API forums. It looks as though this Windows part of the SDK was not tested before its release.</p>
<p style="text-align: justify;">We eventually has it working on our Windows 7 laptop. It was possible to move the UAV using the keyboard, but the program was really high processor consuming, which often resulted in laggy controls, timeout issues and unresponsive drone. Yet commands were better once the video shut down.</p>
<p style="text-align: justify;">We then took the opportunity to play a little with the source code and do our own stuff, like launching LED animations, but its was overall not satisfying because of the bad response time.</p>
<p>&nbsp;</p>
<table class="aligncenter" width="900">
<tbody>
<tr>
<td><object width="280" height="240"><param name="movie" value="http://www.youtube.com/v/HUMPNfmPGD4?fs=1&amp;hl=en_US" /><param name="allowFullScreen" value="true" /><param name="allowscriptaccess" value="always" /><embed type="application/x-shockwave-flash" width="280" height="240" src="http://www.youtube.com/v/HUMPNfmPGD4?fs=1&amp;hl=en_US" allowscriptaccess="always" allowfullscreen="true"></embed></object></td>
<td><object width="280" height="240"><param name="movie" value="http://www.youtube.com/v/opZwkfFPVL0?fs=1&amp;hl=en_US" /><param name="allowFullScreen" value="true" /><param name="allowscriptaccess" value="always" /><embed type="application/x-shockwave-flash" width="280" height="240" src="http://www.youtube.com/v/opZwkfFPVL0?fs=1&amp;hl=en_US" allowscriptaccess="always" allowfullscreen="true"></embed></object></td>
<td><object width="280" height="240"><param name="movie" value="http://www.youtube.com/v/RQozjFRBhgA?fs=1&amp;hl=en_US" /><param name="allowFullScreen" value="true" /><param name="allowscriptaccess" value="always" /><embed type="application/x-shockwave-flash" width="280" height="240" src="http://www.youtube.com/v/RQozjFRBhgA?fs=1&amp;hl=en_US" allowscriptaccess="always" allowfullscreen="true"></embed></object></td>
</tr>
<tr>
<th>Observe the frequent timeout issues resulting in unwanted moves.</th>
<th>It was still nice to run this Windows example to get a first glance of the raw navigation data in real time directly in our Windows terminal.</th>
<th>Keyboard controls give a good feeling of the drone piloting. Note how CPU demanding this program is.</th>
</tr>
</tbody>
</table>
<p>&nbsp;</p>
<h2>Linux SDK example</h2>
<p style="text-align: justify;">So we had to move on to another platform, that is better supported and knows less issues. Linux with Ubuntu 10.10 proved its magic in this matter, and the instructions to follow in the official developer where quite comprehensive and sufficient to have a running project after a few command lines.</p>
<p style="text-align: justify;">The icing on the cake is that the navigation example gets on improved GUI that displays tons of navigation data in real-time. It is also CPU friendly, is efficient with the video while using the latest firmware, and works well with a game controller.</p>
<div id="attachment_496" class="wp-caption aligncenter" style="width: 648px"><a href="../wp-content/uploads/2011/04/Screenshot-Drone-attitude-viewer_2.png"><img class="size-large wp-image-496" title="Screenshot-Drone attitude viewer_2" src="../wp-content/uploads/2011/04/Screenshot-Drone-attitude-viewer_2-1024x480.png" alt="" width="640" height="300" srcset="../wp-content/uploads/2011/04/Screenshot-Drone-attitude-viewer_2-1024x480.png 1024w, ../wp-content/uploads/2011/04/Screenshot-Drone-attitude-viewer_2-300x140.png 300w, ../wp-content/uploads/2011/04/Screenshot-Drone-attitude-viewer_2-100x46.png 100w, ../wp-content/uploads/2011/04/Screenshot-Drone-attitude-viewer_2.png 1263w" sizes="(max-width: 640px) 100vw, 640px" /></a><p class="wp-caption-text">Excerpt of the Linux navigation screen. The yellow section shows that an oriented roundel has been found on the ground, and provides its orientation, its coordinates (xc, yc) in the camera view, its width, its distance from the drone.</p></div>
<p>The other good news is that the code is more readable, and it was not a pain in the neck to manage to display some data about tag tracking. We indeed fulfill this goal by calling some of the drone embedded functions that enable roundels tracking on the ground or in the air.</p>
<p>Basically, <strong>we can now recognize one or more</strong> -up to five, actually, according to the documentation- <strong>ground robots carrying the same kind of roundels on their back, and report their coordinates with their orientation as well</strong> (coordinates represented in the system of the video capture &#8211; we still have to investigate its specifications). We did not fulfill following one specific robot by hovering over a roundel, since the pre-implemented function does not seem to work anymore (we are waiting for an answer from the developers on their forum). We guess then that we will have to do it by ourselves, which is now our next objective.</p>
<p>As an aside, we discovered the resolution of the vertical camera: it is a QCIF resolution of 176×144 pixels<sup><a href="#footnote_3_495" id="identifier_3_495" class="footnote-link footnote-identifier-link" title="Wikipedia explanations on the CIF conventions">4</a></sup>.<br />
&nbsp;&nbsp;<br />
<b>References</b></p>
<ol class="footnotes">
<li id="footnote_0_495" class="footnote">Have a look at the official and public forums to be kept up to date: http://forum.parrot.com/ardrone/en/viewforum.php?id=7 [<a href="#identifier_0_495" class="footnote-link footnote-back-link">&#8617;</a>]</li>
<li id="footnote_1_495" class="footnote">http://www.ardrone-flyers.com/ is a great website to get answers on how to save your drone by yourself. Previous firmware versions can also be found in its wiki section. [<a href="#identifier_1_495" class="footnote-link footnote-back-link">&#8617;</a>]</li>
<li id="footnote_2_495" class="footnote">Very clear instructions can be followed on this website to achieve that: http://www.sparticusthegrand.com/ardrone/ardrone-compile-windows-sdk-1-5-in-visual-studios-2010/ (it is about SDK 1.5, but still necessary for 1.6)  [<a href="#identifier_2_495" class="footnote-link footnote-back-link">&#8617;</a>]</li>
<li id="footnote_3_495" class="footnote">Wikipedia explanations on the CIF conventions [<a href="#identifier_3_495" class="footnote-link footnote-back-link">&#8617;</a>]</li>
</ol>
<div class='shareaholic-canvas' data-app-id='17416102' data-app='recommendations' data-title='Controlling the drone with our own built program - roundels recognition' data-link='https://www.ludep.com/controlling-the-drone-with-our-own-built-program-roundels-recognition/' data-summary=''></div>		</div>
		<div class="clear"></div>
		
	</div>
		<div id="post-305" class="post post-305 type-post status-publish format-standard has-post-thumbnail hentry category-drone category-issues category-testing">
		<h2 class="h1"><a href="../../the-day-we-crashed-the-drone/" rel="bookmark">The day we crashed the drone</a></h2>

					<table class="info entry-meta">
				<tr>
					<td class="date">April 4, 2011</td>
					<td>
													<span class="postedby">
								Posted by <a href="http://michael/" title="Visit Michael&#8217;s website" rel="author external">Michael</a> 
							</span>
								<span class="filledunder">under</span>
												<span class="filledunder">
							<a href="" rel="category tag">Drone</a>, <a href="../issues/" rel="category tag">Issues</a>, <a href="../testing/" rel="category tag">Testing</a>						</span>
					</td>
											<td>
						
				
							<div class="act">
																	<span class="comments">Comments off</span>
																							</div>
						</td>
					
				</tr>
			</table>
				
									
		
		
		<div class="content">
			
			<div style="float:right;padding: 0 0 10px 10px" class="interactive_right"><iframe allowtransparency="true" frameborder="0" scrolling="no" src="http://platform.twitter.com/widgets/tweet_button.html?url=https%3A%2F%2Fwww.ludep.com%2Fthe-day-we-crashed-the-drone%2F&amp;text=The%20day%20we%20crashed%20the%20drone&amp;count=vertical&amp;lang=" style="width:65px; height:65px;"></iframe><iframe src="http://www.facebook.com/plugins/like.php?href=https%3A%2F%2Fwww.ludep.com%2Fthe-day-we-crashed-the-drone%2F&amp;layout=box_count&amp;show_faces=false&amp;width=65&amp;action=like&amp;font=arial&amp;colorscheme=light&amp;height=65" scrolling="no" frameborder="0" style="border:none; overflow:hidden; width:65px; height:65px;" allowTransparency="true"></iframe></div><p style="text-align: justify;">Sometimes, tragic accidents just happen. Well, we were not exactly surprised by the one that affected us last week, when we damaged our AR.Drone so bad it couldn&#8217;t fly anymore, since we played with fire. Or rather with wind, to be precise. Besides, when you do numerous experiments with a really light device that can fly really high in the sky, you have to expect to perform some repairing, sooner or later.</p>
<p style="text-align: justify;">Events were as follows. So far, our UAV had only been flying indoors, and we really wanted to try it outside, to watch its behavior in a different setting, to test the wireless range, its reactivity to navigation commands, its speed, its ability to hover despite the wind&#8230; We therefore took a laptop, and Xbox 360 controller and our drone in the courtyard next to our building, and started our first outdoor flights.</p>
<p style="text-align: justify;">In spite of an overall mild weather, there was some wind regularly blowing and disturbing from time to time our controls. But the quadricopter proved to be quite steady on the whole and able to respond well, even while being 30 meters away from us. Except with sudden gusts of wind and an obstacle nearby. We crashed it a few times: a window and a vertical pole were its very first close encounters. Those happened however at heights of no more than 2-3 meters, and did not really damage the drone; its security system is indeed really efficient when it comes to shut down the rotors as soon as one of them is blocked. The last accident happened a little higher, around 5 meters; the AR.Drone then immediately stop to start its emergency fall and proceeded to a harsh landing on the concrete ground, using one of its rotors as a shock absorber. Not the best scenario.</p>
<p style="text-align: justify;">As a result, a gear connected to one of the four motors was destroyed, and, worse, the central cross that hold the whole body together was broken at one of four parts. It was still possible to start the drone, but after around two seconds of initiating the rotors &#8211; the four of them were still working once the faulty gear removed &#8211; its internal sensors detected a problem and it automatically shut down (most probably because one motor wasn&#8217;t loaded enough).</p>
<table class="aligncenter" width="700">
<tbody>
<tr>
<td>
<p><div id="attachment_339" class="wp-caption aligncenter" style="width: 308px"><a href="../../wp-content/uploads/2011/04/IMAG0552.jpg"><img class="size-medium wp-image-339" title="Broken central cross" src="../../wp-content/uploads/2011/04/IMAG0552-300x179.jpg" alt="" width="300" height="179" srcset="../wp-content/uploads/2011/04/IMAG0552-300x179.jpg 300w, ../wp-content/uploads/2011/04/IMAG0552-1024x613.jpg 1024w, ../wp-content/uploads/2011/04/IMAG0552-100x59.jpg 100w" sizes="(max-width: 300px) 100vw, 300px" /></a><p class="wp-caption-text">The central cross after our accident. No wire was cut, so we simply tried a glue + duct tape solution to fix it !</p></div></td>
<td>
<p><div id="attachment_340" class="wp-caption aligncenter" style="width: 308px"><a href="../../wp-content/uploads/2011/04/IMAG0560.jpg"><img class="size-medium wp-image-340" title="Broken gear" src="../../wp-content/uploads/2011/04/IMAG0560-300x179.jpg" alt="" width="300" height="179" srcset="../wp-content/uploads/2011/04/IMAG0560-300x179.jpg 300w, ../wp-content/uploads/2011/04/IMAG0560-1024x613.jpg 1024w, ../wp-content/uploads/2011/04/IMAG0560-100x59.jpg 100w" sizes="(max-width: 300px) 100vw, 300px" /></a><p class="wp-caption-text">A gear in a really bad shape, of no use anymore. The drone hit the pavement right with this piece after its 5m fall.</p></div></td>
</tr>
</tbody>
</table>
<p style="text-align: justify;">The good thing with this accident is that we learned quite a lot on the drone itself, since we had to open it completely to perform the &#8220;surgery&#8221;. We have seen that it is highly modular, and its functions are well split into distinct parts: propellers, gears, shafts, motors, central cross, motherboard, navigation board, horizontal camera, hull, and so on. Replacement parts can be ordered and video for each kind of fixation are shown on Parrot official website, so the repairing is easily made, whatever the problem is. It is even possible to rebuild a new drone only thanks to replacement parts.</p>
<table class="aligncenter" width="900">
<tbody>
<tr>
<td>
<p><div id="attachment_342" class="wp-caption aligncenter" style="width: 308px"><a href="../../wp-content/uploads/2011/04/IMAG0609.jpg"><img class="size-medium wp-image-342" title="New gears" src="../../wp-content/uploads/2011/04/IMAG0609-300x179.jpg" alt="" width="300" height="179" srcset="../wp-content/uploads/2011/04/IMAG0609-300x179.jpg 300w, ../wp-content/uploads/2011/04/IMAG0609-1024x613.jpg 1024w, ../wp-content/uploads/2011/04/IMAG0609-100x59.jpg 100w" sizes="(max-width: 300px) 100vw, 300px" /></a><p class="wp-caption-text">A bag of new gears. We also bought a new central cross, but we haven&#39;t use it yet; we will see how long our own repairing lasts.</p></div></td>
<td>
<p><div id="attachment_343" class="wp-caption aligncenter" style="width: 187px"><a href="../../wp-content/uploads/2011/04/IMAG0610.jpg"><img class="size-medium wp-image-343" title="Repairing gear" src="../../wp-content/uploads/2011/04/IMAG0610-179x300.jpg" alt="" width="179" height="300" srcset="../wp-content/uploads/2011/04/IMAG0610-179x300.jpg 179w, ../wp-content/uploads/2011/04/IMAG0610-613x1024.jpg 613w, ../wp-content/uploads/2011/04/IMAG0610-59x100.jpg 59w, ../wp-content/uploads/2011/04/IMAG0610.jpg 1552w" sizes="(max-width: 179px) 100vw, 179px" /></a><p class="wp-caption-text">The finishing touch</p></div></td>
<td>
<p><div id="attachment_344" class="wp-caption aligncenter" style="width: 308px"><a href="../../wp-content/uploads/2011/04/IMAG0613.jpg"><img class="size-medium wp-image-344" title="Fixation done" src="../../wp-content/uploads/2011/04/IMAG0613-300x179.jpg" alt="" width="300" height="179" srcset="../wp-content/uploads/2011/04/IMAG0613-300x179.jpg 300w, ../wp-content/uploads/2011/04/IMAG0613-1024x613.jpg 1024w, ../wp-content/uploads/2011/04/IMAG0613-100x59.jpg 100w" sizes="(max-width: 300px) 100vw, 300px" /></a><p class="wp-caption-text">After fixing it, the drone - seen from below - looks as if it is new.</p></div></td>
</tr>
</tbody>
</table>
<p style="text-align: justify;">Even if we had to wait ten days to get the replacement parts, the good news are that our drone was then fully functional again. We then took the opportunity to make a video &#8211; see below &#8211; of us controlling the drone with a Xbox 360 controller linked to a PC which is connected to the drone&#8217;s hotspot (WD ARDrone and Xpadder were running on the laptop to enable this kind of flight). Watch how steady it is, and the accuracy provided with the gamepad.</p>
<p style="text-align: justify;">&nbsp;</p>
<p><object class="aligncenter" width="480" height="390"><param name="movie" value="http://www.youtube.com/v/12tUVHIWEPc?fs=1&amp;hl=en_US" /><param name="allowFullScreen" value="true" /><param name="allowscriptaccess" value="always" /><embed type="application/x-shockwave-flash" width="480" height="390" src="http://www.youtube.com/v/12tUVHIWEPc?fs=1&amp;hl=en_US" allowscriptaccess="always" allowfullscreen="true"></embed></object></p>
<div class='shareaholic-canvas' data-app-id='17416102' data-app='recommendations' data-title='The day we crashed the drone' data-link='https://www.ludep.com/the-day-we-crashed-the-drone/' data-summary=''></div>		</div>
		<div class="clear"></div>
		
	</div>
		<div id="post-172" class="post post-172 type-post status-publish format-standard has-post-thumbnail hentry category-building category-drone category-ground-robots category-testing">
		<h2 class="h1"><a href="../../first-experiments/" rel="bookmark">First experiments</a></h2>

					<table class="info entry-meta">
				<tr>
					<td class="date">March 24, 2011</td>
					<td>
													<span class="postedby">
								Posted by <a href="../../" title="Visit Guillaume&#8217;s website" rel="author external">Guillaume</a> 
							</span>
								<span class="filledunder">under</span>
												<span class="filledunder">
							<a href="../building/" rel="category tag">Building</a>, <a href="" rel="category tag">Drone</a>, <a href="../ground-robots/" rel="category tag">Ground robots</a>, <a href="../testing/" rel="category tag">Testing</a>						</span>
					</td>
											<td>
						
				
							<div class="act">
																	<span class="comments">Comments off</span>
																							</div>
						</td>
					
				</tr>
			</table>
				
									
		
		
		<div class="content">
			
			<div style="float:right;padding: 0 0 10px 10px" class="interactive_right"><iframe allowtransparency="true" frameborder="0" scrolling="no" src="http://platform.twitter.com/widgets/tweet_button.html?url=https%3A%2F%2Fwww.ludep.com%2Ffirst-experiments%2F&amp;text=First%20experiments&amp;count=vertical&amp;lang=" style="width:65px; height:65px;"></iframe><iframe src="http://www.facebook.com/plugins/like.php?href=https%3A%2F%2Fwww.ludep.com%2Ffirst-experiments%2F&amp;layout=box_count&amp;show_faces=false&amp;width=65&amp;action=like&amp;font=arial&amp;colorscheme=light&amp;height=65" scrolling="no" frameborder="0" style="border:none; overflow:hidden; width:65px; height:65px;" allowTransparency="true"></iframe></div><p style="text-align: justify;">Before going on a coding spree and working on the project itself, we wanted to run some tests just to see if the drone could track a robot on the floor and follow it. But in order to do this, we didn&#8217;t want to code anything so we used a subterfuge: instead of using a tracking feature of the drone, we investigated its stabilization process. Indeed, in order to stay on the same spot when it doesn&#8217;t receive any instructions, the drone uses its own camera pointing at the ground, analyzes the images and try to stay above the pattern it&#8217;s matching at this moment.</p>
<p style="text-align: justify;">In our experiments, we took a ground with an almost uniform surface (this way, it would be hard for the drone to find a landmark to stay stable), made the drone take off, and then we placed the drone above a LEGO land unit with a disk on it (the results seemed to be better with the disk). At this point, the land unit would be a landmark for the drone and according to our theories, if the drone doesn&#8217;t receive any instructions and the land unit move, the drone should follow the car.</p>
<p style="text-align: justify;">&nbsp;</p>
<p style="text-align: center;"><object width="480" height="390"><param name="movie" value="http://www.youtube.com/v/FjzlG3eHaHw?fs=1&amp;hl=en_US&amp;rel=0" /><param name="allowFullScreen" value="true" /><param name="allowscriptaccess" value="always" /><embed type="application/x-shockwave-flash" width="480" height="390" src="http://www.youtube.com/v/FjzlG3eHaHw?fs=1&amp;hl=en_US&amp;rel=0" allowfullscreen="true" allowscriptaccess="always"></embed></object></p>
<p>&nbsp;</p>
<p>The results are better than what we were expecting, you can see by yourself on the video above&#8230; Notice that the right smartphone remotely commands the drone (via WiFi), the left one remotely commands the ground unit (via Bluetooth) and that nobody&#8217;s touching at the drone or its remote control during all the &#8220;tracking&#8221; phase.</p>
<div class='shareaholic-canvas' data-app-id='17416102' data-app='recommendations' data-title='First experiments' data-link='https://www.ludep.com/first-experiments/' data-summary=''></div>		</div>
		<div class="clear"></div>
		
	</div>
		<div id="post-119" class="post post-119 type-post status-publish format-standard has-post-thumbnail hentry category-drone category-ground-robots category-ideas category-refining-the-project category-smartphone category-tasks">
		<h2 class="h1"><a href="../../getting-started/" rel="bookmark">Getting started</a></h2>

					<table class="info entry-meta">
				<tr>
					<td class="date">March 22, 2011</td>
					<td>
													<span class="postedby">
								Posted by <a href="../../" title="Visit Guillaume&#8217;s website" rel="author external">Guillaume</a> 
							</span>
								<span class="filledunder">under</span>
												<span class="filledunder">
							<a href="" rel="category tag">Drone</a>, <a href="../ground-robots/" rel="category tag">Ground robots</a>, <a href="../ideas/" rel="category tag">Ideas</a>, <a href="../refining-the-project/" rel="category tag">Refining the project</a>, <a href="../smartphone/" rel="category tag">Smartphone</a>, <a href="../tasks/" rel="category tag">Tasks</a>						</span>
					</td>
											<td>
						
				
							<div class="act">
																	<span class="comments">Comments off</span>
																							</div>
						</td>
					
				</tr>
			</table>
				
									
		
		
		<div class="content">
			
			<div style="float:right;padding: 0 0 10px 10px" class="interactive_right"><iframe allowtransparency="true" frameborder="0" scrolling="no" src="http://platform.twitter.com/widgets/tweet_button.html?url=https%3A%2F%2Fwww.ludep.com%2Fgetting-started%2F&amp;text=Getting%20started&amp;count=vertical&amp;lang=" style="width:65px; height:65px;"></iframe><iframe src="http://www.facebook.com/plugins/like.php?href=https%3A%2F%2Fwww.ludep.com%2Fgetting-started%2F&amp;layout=box_count&amp;show_faces=false&amp;width=65&amp;action=like&amp;font=arial&amp;colorscheme=light&amp;height=65" scrolling="no" frameborder="0" style="border:none; overflow:hidden; width:65px; height:65px;" allowTransparency="true"></iframe></div><p style="text-align: justify;">First things first, we had to take the time to find out all the equipment we would need, all the objectives we wanted to reach and therefore all the tasks we had to achieve so as to complete the project properly. Nevertheless we obviously can&#8217;t predict everything right now, but we think that the board below gives a rather accurate overview of the project in itself. This board represents our current objectives, so it might not be the last time you see it on this blog section.</p>
<p style="text-align: justify;"> <a href="../wp-content/uploads/2011/03/IMAG0100.jpg"><img class="aligncenter size-large wp-image-1099" title="IMAG0100" src="../wp-content/uploads/2011/03/IMAG0100-1024x613.jpg" alt="" width="640" height="383" srcset="../wp-content/uploads/2011/03/IMAG0100-1024x613.jpg 1024w, ../wp-content/uploads/2011/03/IMAG0100-300x179.jpg 300w, ../wp-content/uploads/2011/03/IMAG0100-100x59.jpg 100w" sizes="(max-width: 640px) 100vw, 640px" /></a></p>
<p style="text-align: justify;">Giving you more details about the project&#8217;s ideas and mechanism should be a good start. The basic idea of the project is to gather a flock of land units in real-time. This flock would have a leader and all the other land units would have to keep in formation. Now the interesting point: all the other robots following the leader would be &#8220;dumb&#8221; robot as we called them in the way that they do not have any sensor mounted on their vehicle. The question being was to find a solution in order to balance this lack of sensor, this absence of communication between those machines and the environment in which they progress.</p>
<p style="text-align: justify;">This question brings us to the interesting part of the project: the use of a drone. Indeed, the drone we&#8217;re using has two cameras on board (on looking straight forward and the other one pointing at the ground). The camera looking down will do some pattern recognition, locate every vehicle and the movement of each land unit will be adjusted so as to keep the formation. Namely, the drone will have to stay above the flock so as a first idea, it will stay above the leader (an autonomous or remote-controlled unit).</p>
<p style="text-align: justify;">So far, we established a list of all we need (that you will probably see in our incoming videos relating our tests) and split the work in different parts which would be:</p>
<ul>
<li style="text-align: justify;">Pattern recognition: how to match patterns, which patterns to use, which platform to use for the image analysis;</li>
<li style="text-align: justify;">Communication : we need to create an interface using the Bluetooth for the computer-land units layer and WiFi for the computer-drone layer;</li>
<li style="text-align: justify;">Algorithmic: which strategy would be the most suitable for the trajectory of the land units and the position of the drone;</li>
<li style="text-align: justify;">Design: making the robots ergonomic, stable, easily movable (for example, should we go on a omniwheel architecture or not&#8230;).</li>
</ul>
<div class='shareaholic-canvas' data-app-id='17416102' data-app='recommendations' data-title='Getting started' data-link='https://www.ludep.com/getting-started/' data-summary=''></div>		</div>
		<div class="clear"></div>
		
	</div>
<!--
		<div class="post">
			 <h2 id="post-119" class="h1"><a href="https://www.ludep.com/getting-started/" rel="bookmark">Getting started</a></h2>
			
							<table class="info entry-meta">
				<tr>
					<td class="date">March 22, 2011</td>
					<td>
													<span class="postedby">
								Posted by <a href="http://www.ludep.com" title="Visit Guillaume&#8217;s website" rel="author external">Guillaume</a> 
							</span>
								<span class="filledunder">under</span>
												<span class="filledunder">
							<a href="https://www.ludep.com/category/drone/" rel="category tag">Drone</a>, <a href="https://www.ludep.com/category/ground-robots/" rel="category tag">Ground robots</a>, <a href="https://www.ludep.com/category/ideas/" rel="category tag">Ideas</a>, <a href="https://www.ludep.com/category/refining-the-project/" rel="category tag">Refining the project</a>, <a href="https://www.ludep.com/category/smartphone/" rel="category tag">Smartphone</a>, <a href="https://www.ludep.com/category/tasks/" rel="category tag">Tasks</a>						</span>
					</td>
											<td>
						
				
							<div class="act">
																	<span class="comments">Comments off</span>
																							</div>
						</td>
					
				</tr>
			</table>
						
			<div class="storycontent">
				<div style="float:right;padding: 0 0 10px 10px" class="interactive_right"><iframe allowtransparency="true" frameborder="0" scrolling="no" src="http://platform.twitter.com/widgets/tweet_button.html?url=https%3A%2F%2Fwww.ludep.com%2Fgetting-started%2F&amp;text=Getting started&amp;count=vertical&amp;lang=  " style="width:65px; height:65px;"></iframe><iframe src="http://www.facebook.com/plugins/like.php?href=https%3A%2F%2Fwww.ludep.com%2Fgetting-started%2F&amp;layout=box_count&amp;show_faces=false&amp;width=65&amp;action=like&amp;font=arial&amp;colorscheme=light&amp;height=65" scrolling="no" frameborder="0" style="border:none; overflow:hidden; width:65px; height:65px;" allowTransparency="true"></iframe></div><p style="text-align: justify;">First things first, we had to take the time to find out all the equipment we would need, all the objectives we wanted to reach and therefore all the tasks we had to achieve so as to complete the project properly. Nevertheless we obviously can&#8217;t predict everything right now, but we think that the board below gives a rather accurate overview of the project in itself. This board represents our current objectives, so it might not be the last time you see it on this blog section.</p>
<p style="text-align: justify;"> <a href="../wp-content/uploads/2011/03/IMAG0100.jpg"><img class="aligncenter size-large wp-image-1099" title="IMAG0100" src="../wp-content/uploads/2011/03/IMAG0100-1024x613.jpg" alt="" width="640" height="383" srcset="../wp-content/uploads/2011/03/IMAG0100-1024x613.jpg 1024w, ../wp-content/uploads/2011/03/IMAG0100-300x179.jpg 300w, ../wp-content/uploads/2011/03/IMAG0100-100x59.jpg 100w" sizes="(max-width: 640px) 100vw, 640px" /></a></p>
<p style="text-align: justify;">Giving you more details about the project&#8217;s ideas and mechanism should be a good start. The basic idea of the project is to gather a flock of land units in real-time. This flock would have a leader and all the other land units would have to keep in formation. Now the interesting point: all the other robots following the leader would be &#8220;dumb&#8221; robot as we called them in the way that they do not have any sensor mounted on their vehicle. The question being was to find a solution in order to balance this lack of sensor, this absence of communication between those machines and the environment in which they progress.</p>
<p style="text-align: justify;">This question brings us to the interesting part of the project: the use of a drone. Indeed, the drone we&#8217;re using has two cameras on board (on looking straight forward and the other one pointing at the ground). The camera looking down will do some pattern recognition, locate every vehicle and the movement of each land unit will be adjusted so as to keep the formation. Namely, the drone will have to stay above the flock so as a first idea, it will stay above the leader (an autonomous or remote-controlled unit).</p>
<p style="text-align: justify;">So far, we established a list of all we need (that you will probably see in our incoming videos relating our tests) and split the work in different parts which would be:</p>
<ul>
<li style="text-align: justify;">Pattern recognition: how to match patterns, which patterns to use, which platform to use for the image analysis;</li>
<li style="text-align: justify;">Communication : we need to create an interface using the Bluetooth for the computer-land units layer and WiFi for the computer-drone layer;</li>
<li style="text-align: justify;">Algorithmic: which strategy would be the most suitable for the trajectory of the land units and the position of the drone;</li>
<li style="text-align: justify;">Design: making the robots ergonomic, stable, easily movable (for example, should we go on a omniwheel architecture or not&#8230;).</li>
</ul>
<div class='shareaholic-canvas' data-app-id='17416102' data-app='recommendations' data-title='Getting started' data-link='https://www.ludep.com/getting-started/' data-summary=''></div>			</div>
			
		</div>
-->
		
		
		<div class="clear"></div>
				</div>
	</div>
</div>


<div class="clear"></div>
<div id="outer-footer">
<div id="footer">

<div id="blue-footer">
	<div class="footer-column">
		
	</div>
</div>
<div class="clear"></div>
</div> <!-- footer -->
</div> <!-- outer-footer -->
<div id="copyright" style="margin:5px; text-align:center; float:left;">
<b>LUDEP</b> powered by <a href="http://wordpress.org/">WordPress</a> and 
<a href="http://vatuma.com/">The Clear Line Theme</a><br/><br/>
</div>
<div style="float:right;">
	<div id="follow-widget-3" style="float:left;"><ul class="followwrap size24 row"><li class="icon_text"><a rel="nofollow me" target="_blank"  style="background: transparent url(../wp-content/plugins/share-and-follow/default/24/facebook.png) no-repeat top left;padding-left:28px;line-height:28px;" class="facebook" href="https://www.facebook.com/pages/Ludep/205635196128367" title="Become a fan"><span class="head">Become a fan</span></a></li><li class="icon_text"><a rel="nofollow me" target="_blank"  style="background: transparent url(../wp-content/plugins/share-and-follow/default/24/rss.png) no-repeat top left;padding-left:28px;line-height:28px;" class="rss" href="../../feed/atom/" title="RSS/Atom feed"><span class="head">RSS/Atom feed</span></a></li><li class="icon_text"><a rel="nofollow me" target="_blank"  style="background: transparent url(../wp-content/plugins/share-and-follow/default/24/twitter.png) no-repeat top left;padding-left:28px;line-height:28px;" class="twitter" href="http://www.twitter.com/LUDEPdotCOM" title="Follow us"><span class="head">Follow us</span></a></li><li class="icon_text"><a rel="nofollow me" target="_blank"  style="background: transparent url(../wp-content/plugins/share-and-follow/default/24/youtube.png) no-repeat top left;padding-left:28px;line-height:28px;" class="youtube" href="http://www.youtube.com/LUDEPdotCOM" title="Youtube channel"><span class="head">Youtube channel</span></a></li></ul><div class="clean"></div> </div>	<div class="clear"></div>
</div>
<div class="clear"></div>
	<input type="hidden" id="social_connect_login_form_uri" value="https://www.ludep.com/wp-login.php" />
	<script type='text/javascript' src='../../wp-includes/js/wp-embed.min9738.js?ver=5.1.8'></script>

		</div> <!--container -->
</body>

<!-- Mirrored from www.ludep.com/category/drone/ by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 15 Mar 2021 00:49:01 GMT -->
</html>